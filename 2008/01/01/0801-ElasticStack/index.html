<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
   
  <meta name="keywords" content="JAVA 全栈 前端 运维 架构师" />
   
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
    0801-ElasticStack |  乘风破浪 披荆斩棘
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/css/main.css">

  
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
  
  

  

<link rel="alternate" href="/atom.xml" title="乘风破浪 披荆斩棘" type="application/atom+xml">
</head>

</html>

<body>
  <div id="app">
    <main class="content">
      <section class="outer">
  <article id="post-0801-ElasticStack" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  0801-ElasticStack
</h1>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2008/01/01/0801-ElasticStack/" class="article-date">
  <time datetime="2007-12-31T16:01:00.000Z" itemprop="datePublished">2008-01-01</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a>
  </div>

      
      
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">14.3k字</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">66分钟</span>
        </span>
    </span>
</div>

      
    </div>
    

    
    
    <div class="tocbot"></div>





    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><h2 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h2><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ElasticSearch是基于ApacheLucene的开源搜索引擎，Lucene可以被认为迄今为止最先进、性能最好、功能最全的搜索引擎库；但是Lucene是Java语法开发，并且非常复杂，需要对其工作原理要有深入理解；ElasticSearch也使用Java开发并使用Lucene来实现核心功能：分布式索引和搜索功能；ElasticSearch通过RESTful API来隐藏Lucene的复杂性，实现搜索引擎的高可用。</p>
<h2 id="ELK"><a href="#ELK" class="headerlink" title="ELK"></a>ELK</h2><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ELK是Elasticsearch、Kibana、Logstash三个技术的组合，组合使用可以解决大部分软件开发中的日志分析与处理工作，能够安全可靠地获取任何来源、任何格式的数据，并且能够实时地对数据进行搜索、分析和可视化；其中，Logstash负责数据的收集，Kibana负责结果数据的可视化展现，Elasticsearch作为核心部分用于数据的分布式存储以及索引。</p>
<h2 id="ElasticStack"><a href="#ElasticStack" class="headerlink" title="ElasticStack"></a>ElasticStack</h2><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ElasticStack表示ES技术栈，在ELK的基础设基础上新增了Beats技术成员，所以ELK重新改名为ElasticStack；ElasticStack的基本工作流程如下图:</p>
<ol>
<li>Beats将采集的各种数据发送到ElasticSearch或交给LogStash进行数据处理</li>
<li>Logstash的主要作用是做数据处理工作</li>
<li>ElasticSearch主要是保存数据</li>
<li>最终Kibana连接ElasticSearch将数据可视化展示</li>
</ol>
<p><img src="https://s1.ax1x.com/2020/04/08/GfcENQ.png" alt="GfcENQ.png"></p>
<ol>
<li><strong>ElasticSearch</strong>：是使用Java语言编写的并且基于Lucene编写的搜索引擎框架，主要特点是：分布式，零配置，自动发现，索引自动分片，索引副本机制，RESTful风格接口，多数据源，自动搜索负载等。核心技术是倒排索引：在ElasticSrearch中数据存储在索引中，ElasticSearch会根据索引中的数据进行分词保存在分词库中；当需要检索数据时候，首先会根据检索关键字在分词库中检索出索引ID，再根据检索的索引ID去索引中直接查找对应的数据；<ul>
<li>Lucene：本身就是一个搜索引擎的底层；</li>
<li>Slor：查询死数据时候，速度相对ES而言Slor更快一些，如果数据实时改变的，Slor速度会受很大影响；ES集群更容易搭建；</li>
<li>分布式：主要是体现在横向扩展能力；</li>
</ul>
</li>
<li><strong>LogStash</strong>：基于Java，是一个开源的用于收集、分析和储存日志的工具</li>
<li><strong>Kibana</strong>：基于Node，Kibna可以为LogStash和ElasticSearch提供友好的web界面，可以汇总，分析，搜索重要数据</li>
<li><strong>Beats</strong>：是elastic公司开源的一款采集系统监控数据的agent，是在被监控的服务器上以客户端的形式运行的数据收集器统称，可以直接把数据发送给ElasticSearch或者通过LogStash发送给ElasticSearch，然后进行后续的数据分析活动。Beat主要的组成：<ul>
<li><strong>Packetbeat</strong>：是一个网络数据包分析器，用于监控、收集网络流量信息，Packetbeat嗅探服务器直接的流量，解析应用层协议，并关联到消息的处理，支持ICMP（IPV4 and IPV6）、DNS、HTTP、MySql、Redis、PostgrpreSQL、MongoDB等协议</li>
<li><strong>Filebeat</strong>：用于监控收集服务器日志文件，以取代logstash forwarder</li>
<li><strong>Metricbeat</strong>：可定期获取外部系统监控指标信息，其可以监控收集Apache、HAProxy、MongoDB、MySql、Nginx、Redis、PostgrpreSQL、Redis、System、ZooKeeper等服务</li>
<li><strong>Winlogbeat</strong>：用于监控收集Windows的日志信息。</li>
</ul>
</li>
</ol>
<h1 id="第一部分-ElasticSearch"><a href="#第一部分-ElasticSearch" class="headerlink" title="第一部分 ElasticSearch"></a>第一部分 ElasticSearch</h1><h2 id="第一章-ES入门"><a href="#第一章-ES入门" class="headerlink" title="第一章 ES入门"></a>第一章 ES入门</h2><h3 id="1-1-单机版安装"><a href="#1-1-单机版安装" class="headerlink" title="1.1 单机版安装"></a>1.1 单机版安装</h3><h4 id="1-Windows系统"><a href="#1-Windows系统" class="headerlink" title="1. Windows系统"></a>1. Windows系统</h4><ul>
<li>下载ElasticSearch：<code>https://www.elastic.co/cn/downloads/elasticsearch</code></li>
<li>解压下载安装包到指定目录</li>
<li>执行es软件包中进入/bin目录：启动elasticsearch.bat脚本文件</li>
<li>测试访问：<code>http://localhost:9200/</code></li>
</ul>
<h4 id="2-Mac系统"><a href="#2-Mac系统" class="headerlink" title="2. Mac系统"></a>2. Mac系统</h4><h4 id="3-Linux系统"><a href="#3-Linux系统" class="headerlink" title="3. Linux系统"></a>3. Linux系统</h4><ul>
<li><p>下载Elastic安装包并解压到软件目录：<code>https://www.elastic.co/cn/downloads/elasticsearch</code></p>
</li>
<li><p><strong>环境准备</strong></p>
<ul>
<li><p>删除CentOS中预安装的Java</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep java</span><br><span class="line">rpm -e --nodeps xxx</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装ElasticSearch对应的JDK</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/opt/jdk</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar </span><br></pre></td></tr></table></figure>
</li>
<li><p>创建ElasticSearch用户：因为ElasticSearch默认不支持root用于运行，所以ElasticSearch需要单独创建用户</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd elsearch</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建ElasticSearch的安装目录，安装目录自定义，这里是安装在opt中是search目录中，并上传ElasticSearch的安装包并解压到search目录中</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line"><span class="built_in">mkdir</span> search</span><br><span class="line"><span class="built_in">chown</span> elsearch:elsearch search/ -R</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>修改系统配置</strong></p>
<ul>
<li><p>配置系统的内存一个进程在VMAS（虚拟内存）创建内存映射的最大数量：<strong>需要使用root用户进行操作</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf		<span class="comment"># 编辑配置文件,修改此文件需要重启Linux服务器</span></span><br><span class="line">vm.max_map_count=655360		<span class="comment"># 修改内存最大映射数量</span></span><br><span class="line">sysctl -p 					<span class="comment"># 查看配置后的信息</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改最大文件描述以满足ELasticSearch：max file descriptors [4096] for elasticsearch process is too low, increase to at least [65535]；*号的位置标示支持的用户名称，*号匹配所有用户</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/security/limits.conf</span><br><span class="line"><span class="comment"># &gt;&gt;&gt;&gt;追加 * 号表示所有用户</span></span><br><span class="line">* soft nofile 65536</span><br><span class="line">* hard nofile 131072</span><br><span class="line">* soft <span class="built_in">nproc</span> 2048</span><br><span class="line">* hard <span class="built_in">nproc</span> 4096</span><br></pre></td></tr></table></figure>
</li>
<li><p>默认进程中的线程数2014太低 最少是4096：max number of threads [3756] for user [elsearch] is too low, increase to at least [4096]</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/security/limits.d/20-nproc.conf</span><br><span class="line"><span class="comment"># &gt;&gt;&gt;&gt;修改</span></span><br><span class="line">*          soft    <span class="built_in">nproc</span>     4096</span><br></pre></td></tr></table></figure>
</li>
<li><p>开启ElasticSearch端口：9200</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=9200/tcp --permanent </span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改ElasticSearch的安装的用户所属并切换到elsearch用户：在启动后ElasticSearch生成的日志相关文件所属也是root用户，需要将这些文件也修改为新建的elsearch（非root用户）的所属；</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> elsearch:elsearch -R /opt/search</span><br><span class="line">su - elsearch</span><br></pre></td></tr></table></figure>
</li>
<li><p>用elsearch（非root用户）用户启动ElasticSearch服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /bin</span><br><span class="line">./elasticsearch		<span class="comment"># 前台启动</span></span><br><span class="line">./elasticsearch &amp;  	<span class="comment"># 后台启动</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>ElasticSearch配置文件说明</strong>：在/opt/search/config/目录中的相关文件</p>
<ul>
<li><p><strong>elasticsearch.yml</strong>：ElasticSearch的启动配置文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------------------------- Cluster -----------------------------------</span></span><br><span class="line"><span class="comment"># 集群名称</span></span><br><span class="line"><span class="comment">#cluster.name: my-application</span></span><br><span class="line"><span class="comment"># ------------------------------------ Node ------------------------------------</span></span><br><span class="line"><span class="comment"># 节点名称:</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node-1</span></span><br><span class="line"><span class="comment"># 节点自定义属性:</span></span><br><span class="line"><span class="comment">#node.attr.rack: r1</span></span><br><span class="line"><span class="comment"># ----------------------------------- Paths ------------------------------------</span></span><br><span class="line"><span class="comment"># 存储数据的目录,多个路径用逗号分隔:</span></span><br><span class="line"><span class="comment">#path.data: /path/to/data</span></span><br><span class="line"><span class="comment"># 日志文件目录:</span></span><br><span class="line"><span class="comment">#path.logs: /path/to/logs</span></span><br><span class="line"><span class="comment"># ----------------------------------- Memory -----------------------------------</span></span><br><span class="line"><span class="comment"># 启动时是否锁定内存:</span></span><br><span class="line"><span class="comment">#bootstrap.memory_lock: true</span></span><br><span class="line"><span class="comment"># ---------------------------------- Network -----------------------------------</span></span><br><span class="line"><span class="comment"># 将绑定地址设置为特定的IP (IPv4或IPv6) 0 任意端口可以访问</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="comment"># 为HTTP设置自定义端口:</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="comment"># --------------------------------- Discovery ----------------------------------</span></span><br><span class="line"><span class="comment">#当这个节点启动时，传递一个初始的主机列表来执行发现: 默认的主机列表是[&quot;127.0.0.1&quot;，&quot;[::1]&quot;]</span></span><br><span class="line"><span class="comment">#discovery.seed_hosts: [&quot;host1&quot;, &quot;host2&quot;]</span></span><br><span class="line"><span class="comment"># 使用主节点的初始集合引导集群:</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> [<span class="string">&quot;node-1&quot;</span>]</span><br><span class="line"><span class="comment"># ---------------------------------- Gateway -----------------------------------</span></span><br><span class="line"><span class="comment"># 在整个集群重新启动后阻塞初始恢复，直到N个节点启动:</span></span><br><span class="line"><span class="comment">#gateway.recover_after_nodes: 3</span></span><br><span class="line"><span class="comment"># ---------------------------------- Various -----------------------------------</span></span><br><span class="line"><span class="comment"># 删除索引时要求显式名称:</span></span><br><span class="line"><span class="comment">#action.destructive_requires_name: true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>jvm.options</strong>：ElasticSearch是基于Java开发，jvm.options用于设置ElasticSearch运行时jvm环境相关配置；ElasticSearch中的host配置不是localhost或127.0.0.1会被认为是生产环境，会多ElasticSearch启动要求比较高；</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Xms 表示总的堆空间的初始大小</span></span><br><span class="line"><span class="comment"># Xmx 表示堆空间的最大大小</span></span><br><span class="line"><span class="attr">-Xms128m</span></span><br><span class="line"><span class="attr">-Xmx128m</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>log4j2.properties</p>
</li>
</ul>
</li>
<li><p>启动ElasticSearch：安装包/bin目录中执行启动脚本，测试ES服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 127.0.0.1:9200</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="4-Docker命令行"><a href="#4-Docker命令行" class="headerlink" title="4. Docker命令行"></a>4. Docker命令行</h4><ul>
<li><p>使用Docker命令行安装</p>
<ul>
<li><p>下载ElasticSearch镜像</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull elasticsearch:8.0.1</span><br></pre></td></tr></table></figure>
</li>
<li><p>将镜像中的配置文件备份到宿主机中的config目录中</p>
</li>
<li><p>使用命令行安装docker：①需要准备好宿主机中config中的配置文件②修改下面命令行中的数据集容器卷路径</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name es801 \</span><br><span class="line">-p 9200:9200 -p 9300:9300 \</span><br><span class="line">-v ~/source_docker/es/data:/usr/share/elasticsearch/data \</span><br><span class="line">-v ~/source_docker/es/config:/usr/share/elasticsearch/config \</span><br><span class="line">-v ~/source_docker/es/logs:/usr/share/elasticsearch/logs \</span><br><span class="line">-v ~/source_docker/es/plugins:/usr/share/elasticsearch/plugins \</span><br><span class="line">-e ES_JAVA_OPTS=<span class="string">&quot;-Xms64m -Xmx512m&quot;</span> \</span><br><span class="line">-e <span class="string">&quot;discovery.type=single-node&quot;</span> elasticsearch:8.0.1</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h4 id="5-DockerFile安装"><a href="#5-DockerFile安装" class="headerlink" title="5. DockerFile安装"></a>5. DockerFile安装</h4><h4 id="6-DockerCompose安装"><a href="#6-DockerCompose安装" class="headerlink" title="6. DockerCompose安装"></a>6. DockerCompose安装</h4><ul>
<li><p>使用Docker命令下载镜像</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker pull elasticsearch:8.2.0</span><br><span class="line">docker pull kibana:8.2.0</span><br><span class="line">docker pull elasticsearch:7.17.3</span><br><span class="line">docker pull kibana:7.17.3</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化DockerCompose安装目录</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ElasticSearch8/</span><br><span class="line">	es8/</span><br><span class="line">		/data/</span><br><span class="line">		/logs/</span><br><span class="line">		/config/</span><br><span class="line">			/elasticsearch.yml</span><br><span class="line">			/jvm.options</span><br><span class="line">			/log4j2.properties</span><br><span class="line">	kibana/</span><br><span class="line">		config/kibana.yml</span><br></pre></td></tr></table></figure>
</li>
<li><p>准备配置文件：elasticsearch.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------------------------- Cluster -----------------------------------</span></span><br><span class="line"><span class="comment"># 集群名称</span></span><br><span class="line"><span class="comment">#cluster.name: my-application</span></span><br><span class="line"><span class="comment"># ------------------------------------ Node ------------------------------------</span></span><br><span class="line"><span class="comment"># 节点名称:</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node-1</span></span><br><span class="line"><span class="comment"># 节点自定义属性:</span></span><br><span class="line"><span class="comment">#node.attr.rack: r1</span></span><br><span class="line"><span class="comment"># ----------------------------------- Paths ------------------------------------</span></span><br><span class="line"><span class="comment"># 存储数据的目录,多个路径用逗号分隔:</span></span><br><span class="line"><span class="comment">#path.data: /path/to/data</span></span><br><span class="line"><span class="comment"># 日志文件目录:</span></span><br><span class="line"><span class="comment">#path.logs: /path/to/logs</span></span><br><span class="line"><span class="comment"># ----------------------------------- Memory -----------------------------------</span></span><br><span class="line"><span class="comment"># 启动时是否锁定内存:</span></span><br><span class="line"><span class="comment">#bootstrap.memory_lock: true</span></span><br><span class="line"><span class="comment"># ---------------------------------- Network -----------------------------------</span></span><br><span class="line"><span class="comment"># 将绑定地址设置为特定的IP (IPv4或IPv6) 0 任意端口可以访问</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="comment"># 为HTTP设置自定义端口:</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="comment"># --------------------------------- Discovery ----------------------------------</span></span><br><span class="line"><span class="comment">#当这个节点启动时，传递一个初始的主机列表来执行发现: 默认的主机列表是[&quot;127.0.0.1&quot;，&quot;[::1]&quot;]</span></span><br><span class="line"><span class="comment">#discovery.seed_hosts: [&quot;host1&quot;, &quot;host2&quot;]</span></span><br><span class="line"><span class="comment"># 使用主节点的初始集合引导集群:</span></span><br><span class="line"><span class="comment"># cluster.initial_master_nodes: [&quot;node-1&quot;]</span></span><br><span class="line"><span class="comment"># ---------------------------------- Gateway -----------------------------------</span></span><br><span class="line"><span class="comment"># 在整个集群重新启动后阻塞初始恢复，直到N个节点启动:</span></span><br><span class="line"><span class="comment">#gateway.recover_after_nodes: 3</span></span><br><span class="line"><span class="comment"># ---------------------------------- Various -----------------------------------</span></span><br><span class="line"><span class="comment"># 删除索引时要求显式名称:</span></span><br><span class="line"><span class="comment">#action.destructive_requires_name: true</span></span><br><span class="line"><span class="attr">xpack.security.enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动需要JVM配置文件：jvm.options</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## GC configuration</span></span><br><span class="line"><span class="attr">8-13</span>:<span class="string">-XX:+UseConcMarkSweepGC</span></span><br><span class="line"><span class="attr">8-13</span>:<span class="string">-XX:CMSInitiatingOccupancyFraction=75</span></span><br><span class="line"><span class="attr">8-13</span>:<span class="string">-XX:+UseCMSInitiatingOccupancyOnly</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">## G1GC Configuration</span></span><br><span class="line"><span class="comment"># to use G1GC, uncomment the next two lines and update the version on the</span></span><br><span class="line"><span class="comment"># following three lines to your version of the JDK</span></span><br><span class="line"><span class="comment"># 8-13:-XX:-UseConcMarkSweepGC</span></span><br><span class="line"><span class="comment"># 8-13:-XX:-UseCMSInitiatingOccupancyOnly</span></span><br><span class="line"><span class="attr">14-</span>:<span class="string">-XX:+UseG1GC</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">## JVM temporary directory</span></span><br><span class="line"><span class="attr">-Djava.io.tmpdir</span>=<span class="string">$&#123;ES_TMPDIR&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">## heap dumps</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># generate a heap dump when an allocation from the Java heap fails; heap dumps</span></span><br><span class="line"><span class="comment"># are created in the working directory of the JVM unless an alternative path is</span></span><br><span class="line"><span class="comment"># specified</span></span><br><span class="line"><span class="attr">-XX</span>:<span class="string">+HeapDumpOnOutOfMemoryError</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># exit right after heap dump on out of memory error. Recommended to also use</span></span><br><span class="line"><span class="comment"># on java 8 for supported versions (8u92+).</span></span><br><span class="line"><span class="attr">9-</span>:<span class="string">-XX:+ExitOnOutOfMemoryError</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># specify an alternative path for heap dumps; ensure the directory exists and</span></span><br><span class="line"><span class="comment"># has sufficient space</span></span><br><span class="line"><span class="attr">-XX</span>:<span class="string">HeapDumpPath=data</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># specify an alternative path for JVM fatal error logs</span></span><br><span class="line"><span class="attr">-XX</span>:<span class="string">ErrorFile=logs/hs_err_pid%p.log</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">## GC logging</span></span><br><span class="line"><span class="attr">-Xlog</span>:<span class="string">gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>log4j2.properties：安装包默认的log4j2日志文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">status</span> = <span class="string">error</span></span><br><span class="line"></span><br><span class="line"><span class="attr">appender.console.type</span> = <span class="string">Console</span></span><br><span class="line"><span class="attr">appender.console.name</span> = <span class="string">console</span></span><br><span class="line"><span class="attr">appender.console.layout.type</span> = <span class="string">PatternLayout</span></span><br><span class="line"><span class="attr">appender.console.layout.pattern</span> = <span class="string">[%d&#123;ISO8601&#125;][%-5p][%-25c&#123;1.&#125;] [%node_name]%marker %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######## Server JSON ############################</span></span><br><span class="line"><span class="attr">appender.rolling.type</span> = <span class="string">RollingFile</span></span><br><span class="line"><span class="attr">appender.rolling.name</span> = <span class="string">rolling</span></span><br><span class="line"><span class="attr">appender.rolling.fileName</span> = <span class="string">$&#123;sys:es.logs.base_path&#125;$&#123;sys:file.separator&#125;$&#123;sys:es.logs.cluster_name&#125;_server.json</span></span><br><span class="line"><span class="attr">appender.rolling.layout.type</span> = <span class="string">ECSJsonLayout</span></span><br><span class="line"><span class="attr">appender.rolling.layout.dataset</span> = <span class="string">elasticsearch.server</span></span><br><span class="line"></span><br><span class="line"><span class="attr">appender.rolling.filePattern</span> = <span class="string">$&#123;sys:es.logs.base_path&#125;$&#123;sys:file.separator&#125;$&#123;sys:es.logs.cluster_name&#125;-%d&#123;yyyy-MM-dd&#125;-%i.json.gz</span></span><br><span class="line"><span class="attr">appender.rolling.policies.type</span> = <span class="string">Policies</span></span><br><span class="line"><span class="attr">appender.rolling.policies.time.type</span> = <span class="string">TimeBasedTriggeringPolicy</span></span><br><span class="line"><span class="attr">appender.rolling.policies.time.interval</span> = <span class="string">1</span></span><br><span class="line"><span class="attr">appender.rolling.policies.time.modulate</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">appender.rolling.policies.size.type</span> = <span class="string">SizeBasedTriggeringPolicy</span></span><br><span class="line"><span class="attr">appender.rolling.policies.size.size</span> = <span class="string">128MB</span></span><br><span class="line"><span class="attr">appender.rolling.strategy.type</span> = <span class="string">DefaultRolloverStrategy</span></span><br><span class="line"><span class="attr">appender.rolling.strategy.fileIndex</span> = <span class="string">nomax</span></span><br><span class="line"><span class="attr">appender.rolling.strategy.action.type</span> = <span class="string">Delete</span></span><br><span class="line"><span class="attr">appender.rolling.strategy.action.basepath</span> = <span class="string">$&#123;sys:es.logs.base_path&#125;</span></span><br><span class="line"><span class="attr">appender.rolling.strategy.action.condition.type</span> = <span class="string">IfFileName</span></span><br><span class="line"><span class="attr">appender.rolling.strategy.action.condition.glob</span> = <span class="string">$&#123;sys:es.logs.cluster_name&#125;-*</span></span><br><span class="line"><span class="attr">appender.rolling.strategy.action.condition.nested_condition.type</span> = <span class="string">IfAccumulatedFileSize</span></span><br><span class="line"><span class="attr">appender.rolling.strategy.action.condition.nested_condition.exceeds</span> = <span class="string">2GB</span></span><br><span class="line"><span class="comment">################################################</span></span><br><span class="line"><span class="comment">######## Server -  old style pattern ###########</span></span><br><span class="line"><span class="attr">appender.rolling_old.type</span> = <span class="string">RollingFile</span></span><br><span class="line"><span class="attr">appender.rolling_old.name</span> = <span class="string">rolling_old</span></span><br><span class="line"><span class="attr">appender.rolling_old.fileName</span> = <span class="string">$&#123;sys:es.logs.base_path&#125;$&#123;sys:file.separator&#125;$&#123;sys:es.logs.cluster_name&#125;.log</span></span><br><span class="line"><span class="attr">appender.rolling_old.layout.type</span> = <span class="string">PatternLayout</span></span><br><span class="line"><span class="attr">appender.rolling_old.layout.pattern</span> = <span class="string">[%d&#123;ISO8601&#125;][%-5p][%-25c&#123;1.&#125;] [%node_name]%marker %m%n</span></span><br><span class="line"></span><br><span class="line"><span class="attr">appender.rolling_old.filePattern</span> = <span class="string">$&#123;sys:es.logs.base_path&#125;$&#123;sys:file.separator&#125;$&#123;sys:es.logs.cluster_name&#125;-%d&#123;yyyy-MM-dd&#125;-%i.log.gz</span></span><br><span class="line"><span class="attr">appender.rolling_old.policies.type</span> = <span class="string">Policies</span></span><br><span class="line"><span class="attr">appender.rolling_old.policies.time.type</span> = <span class="string">TimeBasedTriggeringPolicy</span></span><br><span class="line"><span class="attr">appender.rolling_old.policies.time.interval</span> = <span class="string">1</span></span><br><span class="line"><span class="attr">appender.rolling_old.policies.time.modulate</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">appender.rolling_old.policies.size.type</span> = <span class="string">SizeBasedTriggeringPolicy</span></span><br><span class="line"><span class="attr">appender.rolling_old.policies.size.size</span> = <span class="string">128MB</span></span><br><span class="line"><span class="attr">appender.rolling_old.strategy.type</span> = <span class="string">DefaultRolloverStrategy</span></span><br><span class="line"><span class="attr">appender.rolling_old.strategy.fileIndex</span> = <span class="string">nomax</span></span><br><span class="line"><span class="attr">appender.rolling_old.strategy.action.type</span> = <span class="string">Delete</span></span><br><span class="line"><span class="attr">appender.rolling_old.strategy.action.basepath</span> = <span class="string">$&#123;sys:es.logs.base_path&#125;</span></span><br><span class="line"><span class="attr">appender.rolling_old.strategy.action.condition.type</span> = <span class="string">IfFileName</span></span><br><span class="line"><span class="attr">appender.rolling_old.strategy.action.condition.glob</span> = <span class="string">$&#123;sys:es.logs.cluster_name&#125;-*</span></span><br><span class="line"><span class="attr">appender.rolling_old.strategy.action.condition.nested_condition.type</span> = <span class="string">IfAccumulatedFileSize</span></span><br><span class="line"><span class="attr">appender.rolling_old.strategy.action.condition.nested_condition.exceeds</span> = <span class="string">2GB</span></span><br><span class="line"><span class="comment">################################################</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rootLogger.level</span> = <span class="string">info</span></span><br><span class="line"><span class="attr">rootLogger.appenderRef.console.ref</span> = <span class="string">console</span></span><br><span class="line"><span class="attr">rootLogger.appenderRef.rolling.ref</span> = <span class="string">rolling</span></span><br><span class="line"><span class="attr">rootLogger.appenderRef.rolling_old.ref</span> = <span class="string">rolling_old</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######## Deprecation JSON #######################</span></span><br><span class="line"><span class="attr">appender.deprecation_rolling.type</span> = <span class="string">RollingFile</span></span><br><span class="line"><span class="attr">appender.deprecation_rolling.name</span> = <span class="string">deprecation_rolling</span></span><br><span class="line"><span class="attr">appender.deprecation_rolling.fileName</span> = <span class="string">$&#123;sys:es.logs.base_path&#125;$&#123;sys:file.separator&#125;$&#123;sys:es.logs.cluster_name&#125;_deprecation.json</span></span><br><span class="line"><span class="attr">appender.deprecation_rolling.layout.type</span> = <span class="string">ECSJsonLayout</span></span><br><span class="line"><span class="comment"># Intentionally follows a different pattern to above</span></span><br><span class="line"><span class="attr">appender.deprecation_rolling.layout.dataset</span> = <span class="string">deprecation.elasticsearch</span></span><br><span class="line"><span class="attr">appender.deprecation_rolling.filter.rate_limit.type</span> = <span class="string">RateLimitingFilter</span></span><br><span class="line"></span><br><span class="line"><span class="attr">appender.deprecation_rolling.filePattern</span> = <span class="string">$&#123;sys:es.logs.base_path&#125;$&#123;sys:file.separator&#125;$&#123;sys:es.logs.cluster_name&#125;_deprecation-%i.json.gz</span></span><br><span class="line"><span class="attr">appender.deprecation_rolling.policies.type</span> = <span class="string">Policies</span></span><br><span class="line"><span class="attr">appender.deprecation_rolling.policies.size.type</span> = <span class="string">SizeBasedTriggeringPolicy</span></span><br><span class="line"><span class="attr">appender.deprecation_rolling.policies.size.size</span> = <span class="string">1GB</span></span><br><span class="line"><span class="attr">appender.deprecation_rolling.strategy.type</span> = <span class="string">DefaultRolloverStrategy</span></span><br><span class="line"><span class="attr">appender.deprecation_rolling.strategy.max</span> = <span class="string">4</span></span><br><span class="line"></span><br><span class="line"><span class="attr">appender.header_warning.type</span> = <span class="string">HeaderWarningAppender</span></span><br><span class="line"><span class="attr">appender.header_warning.name</span> = <span class="string">header_warning</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logger.deprecation.name</span> = <span class="string">org.elasticsearch.deprecation</span></span><br><span class="line"><span class="attr">logger.deprecation.level</span> = <span class="string">WARN</span></span><br><span class="line"><span class="attr">logger.deprecation.appenderRef.deprecation_rolling.ref</span> = <span class="string">deprecation_rolling</span></span><br><span class="line"><span class="attr">logger.deprecation.appenderRef.header_warning.ref</span> = <span class="string">header_warning</span></span><br><span class="line"><span class="attr">logger.deprecation.additivity</span> = <span class="string">false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######## Search slowlog JSON ####################</span></span><br><span class="line"><span class="attr">appender.index_search_slowlog_rolling.type</span> = <span class="string">RollingFile</span></span><br><span class="line"><span class="attr">appender.index_search_slowlog_rolling.name</span> = <span class="string">index_search_slowlog_rolling</span></span><br><span class="line"><span class="attr">appender.index_search_slowlog_rolling.fileName</span> = <span class="string">$&#123;sys:es.logs.base_path&#125;$&#123;sys:file.separator&#125;$&#123;sys:es.logs\</span></span><br><span class="line"><span class="string">  .cluster_name&#125;_index_search_slowlog.json</span></span><br><span class="line"><span class="attr">appender.index_search_slowlog_rolling.layout.type</span> = <span class="string">ECSJsonLayout</span></span><br><span class="line"><span class="attr">appender.index_search_slowlog_rolling.layout.dataset</span> = <span class="string">elasticsearch.index_search_slowlog</span></span><br><span class="line"></span><br><span class="line"><span class="attr">appender.index_search_slowlog_rolling.filePattern</span> = <span class="string">$&#123;sys:es.logs.base_path&#125;$&#123;sys:file.separator&#125;$&#123;sys:es.logs\</span></span><br><span class="line"><span class="string">  .cluster_name&#125;_index_search_slowlog-%i.json.gz</span></span><br><span class="line"><span class="attr">appender.index_search_slowlog_rolling.policies.type</span> = <span class="string">Policies</span></span><br><span class="line"><span class="attr">appender.index_search_slowlog_rolling.policies.size.type</span> = <span class="string">SizeBasedTriggeringPolicy</span></span><br><span class="line"><span class="attr">appender.index_search_slowlog_rolling.policies.size.size</span> = <span class="string">1GB</span></span><br><span class="line"><span class="attr">appender.index_search_slowlog_rolling.strategy.type</span> = <span class="string">DefaultRolloverStrategy</span></span><br><span class="line"><span class="attr">appender.index_search_slowlog_rolling.strategy.max</span> = <span class="string">4</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="attr">logger.index_search_slowlog_rolling.name</span> = <span class="string">index.search.slowlog</span></span><br><span class="line"><span class="attr">logger.index_search_slowlog_rolling.level</span> = <span class="string">trace</span></span><br><span class="line"><span class="attr">logger.index_search_slowlog_rolling.appenderRef.index_search_slowlog_rolling.ref</span> = <span class="string">index_search_slowlog_rolling</span></span><br><span class="line"><span class="attr">logger.index_search_slowlog_rolling.additivity</span> = <span class="string">false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######## Indexing slowlog JSON ##################</span></span><br><span class="line"><span class="attr">appender.index_indexing_slowlog_rolling.type</span> = <span class="string">RollingFile</span></span><br><span class="line"><span class="attr">appender.index_indexing_slowlog_rolling.name</span> = <span class="string">index_indexing_slowlog_rolling</span></span><br><span class="line"><span class="attr">appender.index_indexing_slowlog_rolling.fileName</span> = <span class="string">$&#123;sys:es.logs.base_path&#125;$&#123;sys:file.separator&#125;$&#123;sys:es.logs.cluster_name&#125;\</span></span><br><span class="line"><span class="string">  _index_indexing_slowlog.json</span></span><br><span class="line"><span class="attr">appender.index_indexing_slowlog_rolling.layout.type</span> = <span class="string">ECSJsonLayout</span></span><br><span class="line"><span class="attr">appender.index_indexing_slowlog_rolling.layout.dataset</span> = <span class="string">elasticsearch.index_indexing_slowlog</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">appender.index_indexing_slowlog_rolling.filePattern</span> = <span class="string">$&#123;sys:es.logs.base_path&#125;$&#123;sys:file.separator&#125;$&#123;sys:es.logs.cluster_name&#125;\</span></span><br><span class="line"><span class="string">  _index_indexing_slowlog-%i.json.gz</span></span><br><span class="line"><span class="attr">appender.index_indexing_slowlog_rolling.policies.type</span> = <span class="string">Policies</span></span><br><span class="line"><span class="attr">appender.index_indexing_slowlog_rolling.policies.size.type</span> = <span class="string">SizeBasedTriggeringPolicy</span></span><br><span class="line"><span class="attr">appender.index_indexing_slowlog_rolling.policies.size.size</span> = <span class="string">1GB</span></span><br><span class="line"><span class="attr">appender.index_indexing_slowlog_rolling.strategy.type</span> = <span class="string">DefaultRolloverStrategy</span></span><br><span class="line"><span class="attr">appender.index_indexing_slowlog_rolling.strategy.max</span> = <span class="string">4</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">logger.index_indexing_slowlog.name</span> = <span class="string">index.indexing.slowlog.index</span></span><br><span class="line"><span class="attr">logger.index_indexing_slowlog.level</span> = <span class="string">trace</span></span><br><span class="line"><span class="attr">logger.index_indexing_slowlog.appenderRef.index_indexing_slowlog_rolling.ref</span> = <span class="string">index_indexing_slowlog_rolling</span></span><br><span class="line"><span class="attr">logger.index_indexing_slowlog.additivity</span> = <span class="string">false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">logger.com_amazonaws.name</span> = <span class="string">com.amazonaws</span></span><br><span class="line"><span class="attr">logger.com_amazonaws.level</span> = <span class="string">warn</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logger.com_amazonaws_jmx_SdkMBeanRegistrySupport.name</span> = <span class="string">com.amazonaws.jmx.SdkMBeanRegistrySupport</span></span><br><span class="line"><span class="attr">logger.com_amazonaws_jmx_SdkMBeanRegistrySupport.level</span> = <span class="string">error</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logger.com_amazonaws_metrics_AwsSdkMetrics.name</span> = <span class="string">com.amazonaws.metrics.AwsSdkMetrics</span></span><br><span class="line"><span class="attr">logger.com_amazonaws_metrics_AwsSdkMetrics.level</span> = <span class="string">error</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logger.com_amazonaws_auth_profile_internal_BasicProfileConfigFileLoader.name</span> = <span class="string">com.amazonaws.auth.profile.internal.BasicProfileConfigFileLoader</span></span><br><span class="line"><span class="attr">logger.com_amazonaws_auth_profile_internal_BasicProfileConfigFileLoader.level</span> = <span class="string">error</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logger.com_amazonaws_services_s3_internal_UseArnRegionResolver.name</span> = <span class="string">com.amazonaws.services.s3.internal.UseArnRegionResolver</span></span><br><span class="line"><span class="attr">logger.com_amazonaws_services_s3_internal_UseArnRegionResolver.level</span> = <span class="string">error</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">appender.audit_rolling.type</span> = <span class="string">RollingFile</span></span><br><span class="line"><span class="attr">appender.audit_rolling.name</span> = <span class="string">audit_rolling</span></span><br><span class="line"><span class="attr">appender.audit_rolling.fileName</span> = <span class="string">$&#123;sys:es.logs.base_path&#125;$&#123;sys:file.separator&#125;$&#123;sys:es.logs.cluster_name&#125;_audit.json</span></span><br><span class="line"><span class="attr">appender.audit_rolling.layout.type</span> = <span class="string">PatternLayout</span></span><br><span class="line"><span class="attr">appender.audit_rolling.layout.pattern</span> = <span class="string">&#123;\</span></span><br><span class="line"><span class="string">                &quot;type&quot;:&quot;audit&quot;, \</span></span><br><span class="line"><span class="string">                &quot;timestamp&quot;:&quot;%d&#123;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss,SSSZ&#125;&quot;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;cluster.name&quot;:&quot;%enc&#123;%map&#123;cluster.name&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;cluster.uuid&quot;:&quot;%enc&#123;%map&#123;cluster.uuid&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;node.name&quot;:&quot;%enc&#123;%map&#123;node.name&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;node.id&quot;:&quot;%enc&#123;%map&#123;node.id&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;host.name&quot;:&quot;%enc&#123;%map&#123;host.name&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;host.ip&quot;:&quot;%enc&#123;%map&#123;host.ip&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;event.type&quot;:&quot;%enc&#123;%map&#123;event.type&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;event.action&quot;:&quot;%enc&#123;%map&#123;event.action&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;authentication.type&quot;:&quot;%enc&#123;%map&#123;authentication.type&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;user.name&quot;:&quot;%enc&#123;%map&#123;user.name&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;user.run_by.name&quot;:&quot;%enc&#123;%map&#123;user.run_by.name&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;user.run_as.name&quot;:&quot;%enc&#123;%map&#123;user.run_as.name&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;user.realm&quot;:&quot;%enc&#123;%map&#123;user.realm&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;user.run_by.realm&quot;:&quot;%enc&#123;%map&#123;user.run_by.realm&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;user.run_as.realm&quot;:&quot;%enc&#123;%map&#123;user.run_as.realm&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;user.roles&quot;:%map&#123;user.roles&#125;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;apikey.id&quot;:&quot;%enc&#123;%map&#123;apikey.id&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;apikey.name&quot;:&quot;%enc&#123;%map&#123;apikey.name&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;authentication.token.name&quot;:&quot;%enc&#123;%map&#123;authentication.token.name&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;authentication.token.type&quot;:&quot;%enc&#123;%map&#123;authentication.token.type&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;origin.type&quot;:&quot;%enc&#123;%map&#123;origin.type&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;origin.address&quot;:&quot;%enc&#123;%map&#123;origin.address&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;realm&quot;:&quot;%enc&#123;%map&#123;realm&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;url.path&quot;:&quot;%enc&#123;%map&#123;url.path&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;url.query&quot;:&quot;%enc&#123;%map&#123;url.query&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;request.method&quot;:&quot;%enc&#123;%map&#123;request.method&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;request.body&quot;:&quot;%enc&#123;%map&#123;request.body&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;request.id&quot;:&quot;%enc&#123;%map&#123;request.id&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;action&quot;:&quot;%enc&#123;%map&#123;action&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;request.name&quot;:&quot;%enc&#123;%map&#123;request.name&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;indices&quot;:%map&#123;indices&#125;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;opaque_id&quot;:&quot;%enc&#123;%map&#123;opaque_id&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;trace.id&quot;:&quot;%enc&#123;%map&#123;trace.id&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;x_forwarded_for&quot;:&quot;%enc&#123;%map&#123;x_forwarded_for&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;transport.profile&quot;:&quot;%enc&#123;%map&#123;transport.profile&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;rule&quot;:&quot;%enc&#123;%map&#123;rule&#125;&#125;&#123;JSON&#125;&quot;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;put&quot;:%map&#123;put&#125;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;delete&quot;:%map&#123;delete&#125;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;change&quot;:%map&#123;change&#125;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;create&quot;:%map&#123;create&#125;&#125;\</span></span><br><span class="line"><span class="string">                %varsNotEmpty&#123;, &quot;invalidate&quot;:%map&#123;invalidate&#125;&#125;\</span></span><br><span class="line"><span class="string">                &#125;%n</span></span><br><span class="line"><span class="comment"># &quot;node.name&quot; node name from the `elasticsearch.yml` settings</span></span><br><span class="line"><span class="comment"># &quot;node.id&quot; node id which should not change between cluster restarts</span></span><br><span class="line"><span class="comment"># &quot;host.name&quot; unresolved hostname of the local node</span></span><br><span class="line"><span class="comment"># &quot;host.ip&quot; the local bound ip (i.e. the ip listening for connections)</span></span><br><span class="line"><span class="comment"># &quot;origin.type&quot; a received REST request is translated into one or more transport requests. This indicates which processing layer generated the event &quot;rest&quot; or &quot;transport&quot; (internal)</span></span><br><span class="line"><span class="comment"># &quot;event.action&quot; the name of the audited event, eg. &quot;authentication_failed&quot;, &quot;access_granted&quot;, &quot;run_as_granted&quot;, etc.</span></span><br><span class="line"><span class="comment"># &quot;authentication.type&quot; one of &quot;realm&quot;, &quot;api_key&quot;, &quot;token&quot;, &quot;anonymous&quot; or &quot;internal&quot;</span></span><br><span class="line"><span class="comment"># &quot;user.name&quot; the subject name as authenticated by a realm</span></span><br><span class="line"><span class="comment"># &quot;user.run_by.name&quot; the original authenticated subject name that is impersonating another one.</span></span><br><span class="line"><span class="comment"># &quot;user.run_as.name&quot; if this &quot;event.action&quot; is of a run_as type, this is the subject name to be impersonated as.</span></span><br><span class="line"><span class="comment"># &quot;user.realm&quot; the name of the realm that authenticated &quot;user.name&quot;</span></span><br><span class="line"><span class="comment"># &quot;user.run_by.realm&quot; the realm name of the impersonating subject (&quot;user.run_by.name&quot;)</span></span><br><span class="line"><span class="comment"># &quot;user.run_as.realm&quot; if this &quot;event.action&quot; is of a run_as type, this is the realm name the impersonated user is looked up from</span></span><br><span class="line"><span class="comment"># &quot;user.roles&quot; the roles array of the user; these are the roles that are granting privileges</span></span><br><span class="line"><span class="comment"># &quot;apikey.id&quot; this field is present if and only if the &quot;authentication.type&quot; is &quot;api_key&quot;</span></span><br><span class="line"><span class="comment"># &quot;apikey.name&quot; this field is present if and only if the &quot;authentication.type&quot; is &quot;api_key&quot;</span></span><br><span class="line"><span class="comment"># &quot;authentication.token.name&quot; this field is present if and only if the authenticating credential is a service account token</span></span><br><span class="line"><span class="comment"># &quot;authentication.token.type&quot; this field is present if and only if the authenticating credential is a service account token</span></span><br><span class="line"><span class="comment"># &quot;event.type&quot; informs about what internal system generated the event; possible values are &quot;rest&quot;, &quot;transport&quot;, &quot;ip_filter&quot; and &quot;security_config_change&quot;</span></span><br><span class="line"><span class="comment"># &quot;origin.address&quot; the remote address and port of the first network hop, i.e. a REST proxy or another cluster node</span></span><br><span class="line"><span class="comment"># &quot;realm&quot; name of a realm that has generated an &quot;authentication_failed&quot; or an &quot;authentication_successful&quot;; the subject is not yet authenticated</span></span><br><span class="line"><span class="comment"># &quot;url.path&quot; the URI component between the port and the query string; it is percent (URL) encoded</span></span><br><span class="line"><span class="comment"># &quot;url.query&quot; the URI component after the path and before the fragment; it is percent (URL) encoded</span></span><br><span class="line"><span class="comment"># &quot;request.method&quot; the method of the HTTP request, i.e. one of GET, POST, PUT, DELETE, OPTIONS, HEAD, PATCH, TRACE, CONNECT</span></span><br><span class="line"><span class="comment"># &quot;request.body&quot; the content of the request body entity, JSON escaped</span></span><br><span class="line"><span class="comment"># &quot;request.id&quot; a synthetic identifier for the incoming request, this is unique per incoming request, and consistent across all audit events generated by that request</span></span><br><span class="line"><span class="comment"># &quot;action&quot; an action is the most granular operation that is authorized and this identifies it in a namespaced way (internal)</span></span><br><span class="line"><span class="comment"># &quot;request.name&quot; if the event is in connection to a transport message this is the name of the request class, similar to how rest requests are identified by the url path (internal)</span></span><br><span class="line"><span class="comment"># &quot;indices&quot; the array of indices that the &quot;action&quot; is acting upon</span></span><br><span class="line"><span class="comment"># &quot;opaque_id&quot; opaque value conveyed by the &quot;X-Opaque-Id&quot; request header</span></span><br><span class="line"><span class="comment"># &quot;trace_id&quot; an identifier conveyed by the part of &quot;traceparent&quot; request header</span></span><br><span class="line"><span class="comment"># &quot;x_forwarded_for&quot; the addresses from the &quot;X-Forwarded-For&quot; request header, as a verbatim string value (not an array)</span></span><br><span class="line"><span class="comment"># &quot;transport.profile&quot; name of the transport profile in case this is a &quot;connection_granted&quot; or &quot;connection_denied&quot; event</span></span><br><span class="line"><span class="comment"># &quot;rule&quot; name of the applied rule if the &quot;origin.type&quot; is &quot;ip_filter&quot;</span></span><br><span class="line"><span class="comment"># the &quot;put&quot;, &quot;delete&quot;, &quot;change&quot;, &quot;create&quot;, &quot;invalidate&quot; fields are only present</span></span><br><span class="line"><span class="comment"># when the &quot;event.type&quot; is &quot;security_config_change&quot; and contain the security config change (as an object) taking effect</span></span><br><span class="line"></span><br><span class="line"><span class="attr">appender.audit_rolling.filePattern</span> = <span class="string">$&#123;sys:es.logs.base_path&#125;$&#123;sys:file.separator&#125;$&#123;sys:es.logs.cluster_name&#125;_audit-%d&#123;yyyy-MM-dd&#125;-%i.json.gz</span></span><br><span class="line"><span class="attr">appender.audit_rolling.policies.type</span> = <span class="string">Policies</span></span><br><span class="line"><span class="attr">appender.audit_rolling.policies.time.type</span> = <span class="string">TimeBasedTriggeringPolicy</span></span><br><span class="line"><span class="attr">appender.audit_rolling.policies.time.interval</span> = <span class="string">1</span></span><br><span class="line"><span class="attr">appender.audit_rolling.policies.time.modulate</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">appender.audit_rolling.policies.size.type</span> = <span class="string">SizeBasedTriggeringPolicy</span></span><br><span class="line"><span class="attr">appender.audit_rolling.policies.size.size</span> = <span class="string">1GB</span></span><br><span class="line"><span class="attr">appender.audit_rolling.strategy.type</span> = <span class="string">DefaultRolloverStrategy</span></span><br><span class="line"><span class="attr">appender.audit_rolling.strategy.fileIndex</span> = <span class="string">nomax</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logger.xpack_security_audit_logfile.name</span> = <span class="string">org.elasticsearch.xpack.security.audit.logfile.LoggingAuditTrail</span></span><br><span class="line"><span class="attr">logger.xpack_security_audit_logfile.level</span> = <span class="string">info</span></span><br><span class="line"><span class="attr">logger.xpack_security_audit_logfile.appenderRef.audit_rolling.ref</span> = <span class="string">audit_rolling</span></span><br><span class="line"><span class="attr">logger.xpack_security_audit_logfile.additivity</span> = <span class="string">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logger.xmlsig.name</span> = <span class="string">org.apache.xml.security.signature.XMLSignature</span></span><br><span class="line"><span class="attr">logger.xmlsig.level</span> = <span class="string">error</span></span><br><span class="line"><span class="attr">logger.samlxml_decrypt.name</span> = <span class="string">org.opensaml.xmlsec.encryption.support.Decrypter</span></span><br><span class="line"><span class="attr">logger.samlxml_decrypt.level</span> = <span class="string">fatal</span></span><br><span class="line"><span class="attr">logger.saml2_decrypt.name</span> = <span class="string">org.opensaml.saml.saml2.encryption.Decrypter</span></span><br><span class="line"><span class="attr">logger.saml2_decrypt.level</span> = <span class="string">fatal</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>docker-compose.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker network create elk</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">es8:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:8.2.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es8</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9200:9200&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9300:9300&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./es8/data:/usr/share/elasticsearch/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./es8/logs:/usr/share/elasticsearch/logs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./es8/config:/usr/share/elasticsearch/config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./es8/plugins:/usr/share/elasticsearch/plugins</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.type=single-node</span></span><br><span class="line">  <span class="attr">kibana8:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">kibana:8.2.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kibana8</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5601:5601&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./kibana8/config:/usr/share/kibana/config</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ELASTICSEARCH_HOSTS:</span> <span class="string">http://es8:9200</span></span><br><span class="line">      <span class="attr">I18N_LOCALE:</span> <span class="string">zh-CN</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">es8</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="comment">## 此处名称与上面创建的网络名称一致</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">elk</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="1-2-术语"><a href="#1-2-术语" class="headerlink" title="1.2 术语"></a>1.2 术语</h3><ol>
<li><p><strong>集群（Cluster）</strong>：包含多个节点，每个节点属于哪个集群是通过一个配置（集群名称，默认是elasticsearch）来决定的，集群的目的为了提供高可用和海量数据的存储以及更快的跨节点查询能力。</p>
</li>
<li><p><strong>节点（Node）</strong>：集群中的一个节点，节点也有一个名称（默认是随机分配的），节点名称很重要（在执行运维管理操作的时候），默认节点会去加入一个名称为“elasticsearch”的集群，如果直接启动一堆节点，那么它们会自动组成一个elasticsearch集群，当然一个节点也可以组成一个elasticsearch集群</p>
</li>
<li><p><strong>索引（Index）</strong>：包含一堆有相似结构的文档数据，一个index包含很多document。在关系型数据库中的概念类似于数据库；</p>
</li>
<li><p><strong>类型（type）</strong>：在ElasticSearch版本7以后废除了type概念，但是保留的type代表的意义，ElasticSearch7以后Type默认值是<code>_doc</code>；而Type的这个概念任然保持一致，都是用来表示索引中文档的基本模型，在关系型数据库中的概念类似数据表，意思是你个索引（数据库）中包含多个Type（数据表），但是在版本7以后一个索引中只包含一个Type（_doc）</p>
</li>
<li><p><strong>文档（Document）</strong>：是ElasticSearch中最小数据单元，一个document代表一条数据，可以理解为关系型数据库中一行数据；</p>
</li>
<li><p><strong>字段（field）</strong>：一个document里面有多个field，每个field就是一个数据字段，可以理解为关系型数据库中一行数据中的每一列；</p>
</li>
<li><p><strong>映射（mapping）</strong>：非常类似于静态语言中的数据类型或者关系型数据库的表结构。mapping还有一些其他的含义，mapping不仅告诉ES一个field中是什么类型的值， 它还告诉ES如何索引数据以及数据是否能被搜索到。</p>
</li>
<li><p><strong>分片（shard）</strong>：也称 Primary Shard，单台机器无法存储大量数据，es可以将一个索引中的数据切分为多个shard，分布在多台服务器上存储。有了shard就可以横向扩展，存储更多数据，让搜索和分析等操作分布到多台服务器上去执行，提升吞吐量和性能。每个shard都是一个lucene index。primary shard（建立索引时一次设置，不能修改，默认5个）。</p>
</li>
<li><p><strong>副本（Replica）</strong>：任何一个服务器随时可能故障或宕机，此时shard可能就会丢失，因此可以为每个shard创建多个replica副本。replica可以在shard故障时提供备用服务，保证数据不丢失，多个replica还可以提升搜索操作的吞吐量和性能。replica shard（随时修改数量，默认1个）。</p>
</li>
<li><p><strong>正向索引和倒排索引</strong>：索引的最终目的都是通过搜索的关键字检索到关键字对应的完整数据；</p>
<ul>
<li><p>正向索引：正向索引的检索过程首先将完整数据的关键数据进行分词，然后通过搜索关键字判断哪些分词中包含有搜索关键字，然后将搜索关键字对应的数据唯一值返回，最后通过这个唯一值查找到完整数据；</p>
<table>
<thead>
<tr>
<th>document的唯一值</th>
<th>对数据进行分词，并且使用“中国”查询数据</th>
</tr>
</thead>
<tbody><tr>
<td>1001</td>
<td>我爱中国 -》 我、爱、中国</td>
</tr>
<tr>
<td>1002</td>
<td>我是中国人-》我、是、中国、中国人</td>
</tr>
<tr>
<td>1003</td>
<td>发展中的国家-》发展、发展中、国家</td>
</tr>
</tbody></table>
</li>
<li><p>倒排索引：倒排索引的索引方式做了改变，也是将数据中的关键数据进行分词，不同的是倒排索引将分词对应的数据的唯一值做映射，如果使用搜索关键字查询时候，如果匹配到分词也就可以得到对应的数据唯一值，然后通过这个唯一值查找到完整数据；比如用上面的三句话用倒排索引生成的结构如下：</p>
<table>
<thead>
<tr>
<th>分词信息</th>
<th><span title='使用假数据演示分词对应的数据的唯一ID值'>数据唯一值</span></th>
</tr>
</thead>
<tbody><tr>
<td>我</td>
<td>1001、1002</td>
</tr>
<tr>
<td>爱</td>
<td>1001</td>
</tr>
<tr>
<td>中国</td>
<td>1001、1002</td>
</tr>
<tr>
<td>中国人</td>
<td>1002</td>
</tr>
<tr>
<td>发展</td>
<td>1003</td>
</tr>
<tr>
<td>发展中</td>
<td>1003</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
<li><p><strong>RestFul风格</strong></p>
<ul>
<li>GET 请求：获取服务器中的对象，</li>
<li>POST 请求：在服务器上更新对象，</li>
<li>PUT 请求：在服务器上创建对象，PUT是幂等操，有些接口重复执行不会影响结果，有些接口重复操作会抛出异常</li>
<li>DELETE 请求：删除服务器中的对象</li>
<li>HEAD 请求：仅仅用于获取对象的基础信息</li>
</ul>
</li>
</ol>
<h3 id="1-3-分词器"><a href="#1-3-分词器" class="headerlink" title="1.3 分词器"></a>1.3 分词器</h3><h4 id="1-分词器概述"><a href="#1-分词器概述" class="headerlink" title="1. 分词器概述"></a>1. 分词器概述</h4><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ElasticSearch是基于Lucene构建的分布式搜索引擎，而分词是词Search是一个构建于Lucene之上的优秀的分布式全文检索引擎（服务器）；ElasticSearch倒排索引的第一步需要将需要被全文检索的内容拆分为可检索的关键字，不同的分词器就会有不同的拆分结果，会直接影响ElasticSearch的检索效率和精确度；总结来说：分词就是<strong>把全文本转换成一系列单词（term/token）的过程</strong>，也叫<strong>文本分析</strong>。在 ES 中，Analysis 是通过<strong>分词器（Analyzer）</strong> 来实现的，可使用 ES 内置的分析器或者按需定制化分析器。</p>
<p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>分词器主要有三部分组成，三个部分是有顺序的，从上到下依次经过 <code>Character Filters</code>，<code>Tokenizer</code> 以及 <code>Token Filters</code>，这个顺序比较好理解，一个文本进来肯定要先对文本数据进行处理，再去分词，最后对分词的结果进行过滤。</p>
<ul>
<li>Character Filters：针对原始文本处理，比如去除 html 标签</li>
<li>Tokenizer：按照规则切分为单词，比如按照空格切分</li>
<li>Token Filters：将切分的单词进行加工，比如大写转小写，删除 stopwords，增加同义语</li>
</ul>
<h4 id="2-常用分词器"><a href="#2-常用分词器" class="headerlink" title="2. 常用分词器"></a>2. 常用分词器</h4><blockquote>
<ul>
<li><p>分词关键关键字</p>
<ul>
<li><code>analyzer</code>指定需要的分词器;</li>
<li><code>text</code>指定要拆分的文本</li>
</ul>
</li>
<li><p>分词结果关键字</p>
<ul>
<li><code>token</code> 为分词结果；</li>
<li><code>start_offset</code> 为起始偏移；</li>
<li><code>end_offset</code> 为结束偏移；</li>
<li><code>position</code> 为分词位置</li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li><p><strong>standard</strong>：默认分词器，按词切分，小写处理，默认的 stopwords 是关闭的。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standard&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;I bought a computer，8761元&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// 分词结果</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;i&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bought&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;a&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;computer&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8761&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">24</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;NUM&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;元&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">24</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">25</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;IDEOGRAPHIC&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>simple</strong>：按照非字母切分（符号被过滤），小写处理</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;simple&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;I bought a computer，8761元&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// 分词结果</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;i&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bought&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;a&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;computer&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;元&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">24</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">25</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>whitespace</strong>：按照空格切分，不转小写</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;whitespace&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;I bought a computer，8761元&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// 分词结果</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;I&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bought&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;a&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;computer，8761元&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">25</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ik_smart</strong>： 会根据词库进行标准分词，<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">下载地址</a>：下载解压到plugins目录并重启es</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我买了一台计算机&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// 分词结果</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_CHAR&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;买了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;一台&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;计算机&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ik_max_word</strong>：会根据词库列表所有的分词结果</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">POST /_analyze</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我买了一台计算机&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// 分词结果</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_CHAR&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;买了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;一台&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;一&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;TYPE_CNUM&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;台&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;COUNT&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;计算机&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;计算&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">6</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;算机&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CN_WORD&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">7</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="3-分词器使用"><a href="#3-分词器使用" class="headerlink" title="3. 分词器使用"></a>3. 分词器使用</h4><ul>
<li><p>分词器有索引时的分词器及搜索时的分词器，可以在mapping中设置，索引分词器采用analyzer进行设置，搜索分词器采用search_analyzer设置，如果没有设置分词器，则索引和搜索分词器都用默认的standard分词器，如果只是设置索引分词器没有设置搜索分词器，则搜索分词器也采用索引分词器，如果analyzer和search_analyzer都设置则使用各自设置的分词器。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置mapping - 定义analyzer索引分词，和搜索分词器使用同一个</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span><span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// 设置mapping - 分别定义analyzer索引分词 和 search_analyzer搜索分词器</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span><span class="string">&quot;english&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;search_analyzer&quot;</span><span class="punctuation">:</span><span class="string">&quot;standard&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// 查询时候指定分词器</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;query&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;洗衣液&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;analyzer&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;standard&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="3-扩展IK词库"><a href="#3-扩展IK词库" class="headerlink" title="3. 扩展IK词库"></a>3. 扩展IK词库</h4><ul>
<li>下载并解压ik分词器到ElasticSearch的home下的plugins文件夹：</li>
<li>在ES的安装路径下找到配置目录custom(如果没有就mkdir),创建用户自定义的词典myTest.dic</li>
<li>ES词典的配置文件为IKAnalyzer.cfg.xml。编辑该文件,加入我们自定义的词典</li>
<li>重启ES</li>
</ul>
<h2 id="第二章-ES数据类型"><a href="#第二章-ES数据类型" class="headerlink" title="第二章 ES数据类型"></a>第二章 ES数据类型</h2><p><img src="https://z3.ax1x.com/2021/10/18/5aRcLT.png" alt="5aRcLT.png"></p>
<h3 id="2-1-基本类型"><a href="#2-1-基本类型" class="headerlink" title="2.1 基本类型"></a>2.1 基本类型</h3><ol>
<li><p><strong>基本类型概述</strong>：分为字符串类型、数字类型、日期类型、布尔类型、基于 BASE64 的二进制类型、范围类型</p>
<ul>
<li>string类型再ES7.0以后就不再支持了，字符串只有两种字符串类型：text 和 keyword</li>
<li>text 类型适用于需要被全文检索的字段，但是<strong>不能被用于排序</strong>如果需要使用该类型的字段只需要在定义映射时指定 JSON 中对应字段的 type 为 text。</li>
<li>keyword 适合简短、结构化字符串，例如主机名、姓名、商品名称等，<strong>可以用于过滤、排序、聚合检索，也可以用于精确查询</strong>。</li>
<li>数字类型：尽量选择范围较小的数据类型，字段长度越短，搜索效率越高，对于浮点数，可以优先考虑使用 scaled_float 类型，该类型可以通过缩放因子来精确浮点数，例如 12.34 可以转换为 1234 来存储。</li>
<li>日期类型：格式化的日期字符串，例如 2020-03-17 00:00、2020/03/17</li>
<li>布尔类型：JSON 字符串类型也可以被 ES 转换为布尔类型存储，前提是字符串的取值为 true 或者 false</li>
<li>二进制类型：二进制类型 binary 接受 BASE64 编码的字符串，默认 store 属性为 false，并且不可以被搜索。</li>
<li>范围类型：用来表达一个数据的区间，可以分为5种：integer_range、float_range、long_range、double_range 以及 date_range。</li>
</ul>
</li>
<li><p>基本类型使用案例</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PUT /user02</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li><strong>text</strong>：类型适用于需要被全文检索的字段，<code>text</code> 类型会被 Lucene 分词器（Analyzer）处理为一个个词项，并使用 Lucene 倒排索引存储，<strong>text 字段不能被用于排序</strong>，</li>
<li><strong>keyword</strong>：用于过滤、排序、聚合检索，也可以用于精确查询。</li>
</ul>
</blockquote>
</li>
</ol>
<h3 id="2-2-复杂类型"><a href="#2-2-复杂类型" class="headerlink" title="2.2 复杂类型"></a>2.2 复杂类型</h3><ol>
<li><p>复杂类型概述：主要有对象类型（object）和嵌套类型（nested）</p>
<ul>
<li><p>对象类型：JSON 字符串允许嵌套对象，一个文档可以嵌套多个、多层对象。可以通过对象类型来存储二级文档，不过由于 Lucene 并没有内部对象的概念，ES 会将原 JSON 文档扁平化，如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;first&quot;</span><span class="punctuation">:</span><span class="string">&quot;fn&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;last&quot;</span><span class="punctuation">:</span><span class="string">&quot;ln&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"># 会被扁平化处理</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name.first&quot;</span><span class="punctuation">:</span><span class="string">&quot;fn&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name.last&quot;</span><span class="punctuation">:</span><span class="string">&quot;ln&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>嵌套类型：可以看成是一个特殊的对象类型，可以让对象数组独立检索，嵌套类型将数组中的每个 JSON 对象作为独立的隐藏文档来存储，每个嵌套的对象都能够独立地被搜索，所以下面案例中虽然表面上只有 1 个文档，但实际上是存储了2个文档。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;users&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;first&quot;</span><span class="punctuation">:</span><span class="string">&quot;fa&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;last&quot;</span><span class="punctuation">:</span><span class="string">&quot;la&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;first&quot;</span><span class="punctuation">:</span><span class="string">&quot;fb&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;last&quot;</span><span class="punctuation">:</span><span class="string">&quot;lb&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>复杂类型使用案例</p>
</li>
</ol>
<h3 id="2-3-地理类型"><a href="#2-3-地理类型" class="headerlink" title="2.3 地理类型"></a>2.3 地理类型</h3><ol>
<li>地理类型概述：分为经纬度类型和地理区域类型<ul>
<li>经纬度类型字段（geo_point）：可以存储经纬度相关信息，通过地理类型的字段，可以用来实现诸如查找在指定地理区域内相关的文档、根据距离排序、根据地理位置修改评分规则等需求。</li>
<li>经纬度类型：可以表达一个点，而 geo_shape 类型可以表达一块地理区域，区域的形状可以是任意多边形，也可以是点、线、面、多点、多线、多面等几何类型。</li>
</ul>
</li>
<li>地理类型使用案例</li>
</ol>
<h3 id="2-4-特殊类型"><a href="#2-4-特殊类型" class="headerlink" title="2.4 特殊类型"></a>2.4 特殊类型</h3><ol>
<li><p>特殊类型概述：包括 IP 类型、过滤器类型、Join 类型、别名类型等</p>
<ul>
<li><p>IP 类型：可以用来存储 IPv4 或者 IPv6 地址，如果需要存储 IP 类型的字段，需要手动定义映射</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;work_ip&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;ip&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Join 类型是 ES 6.x 引入的类型，以取代淘汰的 <code>_parent</code> 元字段，用来实现文档的一对一、一对多的关系，主要用来做父子查询</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如:my_join_field 为 Join 类型字段的名称；relations 指定关系：question 是 answer 的父类。</span></span><br><span class="line">PUT my_index</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;my_join_field&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;join&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;relations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;question&quot;</span><span class="punctuation">:</span> <span class="string">&quot;answer&quot;</span> </span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 例如定义一个 ID 为 1 的父文档：</span></span><br><span class="line">PUT my_join_index/<span class="number">1</span>?refresh</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;This is a question&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;my_join_field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;question&quot;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">// 接下来定义一个子文档，该文档指定了父文档 ID 为 1：</span></span><br><span class="line">PUT my_join_index/_doc/<span class="number">2</span>?routing=<span class="number">1</span>&amp;refresh </span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;This is an answer&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;my_join_field&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;answer&quot;</span><span class="punctuation">,</span> </span><br><span class="line">        <span class="attr">&quot;parent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span> </span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ol>
<ol start="2">
<li>特殊类型使用案例</li>
</ol>
<h2 id="第三章-ES-Mapping"><a href="#第三章-ES-Mapping" class="headerlink" title="第三章 ES Mapping"></a>第三章 ES Mapping</h2><h3 id="3-1-Mapping映射"><a href="#3-1-Mapping映射" class="headerlink" title="3.1 Mapping映射"></a>3.1 Mapping映射</h3><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ElasticSearch中的数据是以JSON文档的格式存储在索引中，ES中文档的格式称为Type；为提高ES检索性能，Type中字段对应的值会处理成特定的数据类型，这些数据类型与文档的对应关系就是Type的Mapping；在早期的版本中一个索引下可以添加多个Type类型的文档；从7.0开始，一个索引只有一个Type，也可以说一个 Type 有一个 Mapping 定义（可以理解为MySQL的表结构，用来约束字段的数据类型）；ES中Mapping的作用如下：</p>
<ul>
<li>定义索引中的字段的名称以及字段对应的数据类型，日期的格式等等；</li>
<li>字段的倒排索引的方式，或者设置是否可以被索引；</li>
<li>自定义规则，用于控制动态添加字段的映射</li>
</ul>
<p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mapping有三种不同的特性，即设置mapping的dynamic属性的三种取值：①当 dynamic 设置为 <code>true</code> 时，这个文档可以被索引进 ES，这个字段也可以被索引，也就是这个字段可以被搜索，Mapping 也同时被更新；②当 dynamic 被设置为 <code>false</code> 时候，存在新增字段的数据写入，该数据可以被索引，但是新增字段被丢弃；③当设置成 <code>strict</code> 模式时候，数据写入直接出错。</p>
<table>
<thead>
<tr>
<th></th>
<th>true</th>
<th>false</th>
<th>strict</th>
</tr>
</thead>
<tbody><tr>
<td>文档可索引</td>
<td>✅</td>
<td>✅</td>
<td>❎</td>
</tr>
<tr>
<td>字段可索引</td>
<td>✅</td>
<td>❎</td>
<td>❎</td>
</tr>
<tr>
<td>mapping可更新</td>
<td>✅</td>
<td>❎</td>
<td>❎</td>
</tr>
</tbody></table>
<p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ES的Type映射方式有两中：①mapping：类似于数据库的schema的定义，mapping会把文档映射成lucene需要的扁平格式，一个mapping属于一个索引的type，一个type中有一个mapping定义；②dynamic mapping：写入文档的时候，索引不存在，会自动创建索引， 无需手动创建，ES会根据内容推断字段的类型，推断会不准确，可能造成某些功能无法使用，例如 范围查询。</p>
<h3 id="3-2-动态映射"><a href="#3-2-动态映射" class="headerlink" title="3.2 动态映射"></a>3.2 动态映射</h3><ul>
<li><p>类型的自动识别关系</p>
<table>
<thead>
<tr>
<th align="center">JSON类型</th>
<th>ElasticSearch dynamic mapping</th>
</tr>
</thead>
<tbody><tr>
<td align="center">字符串</td>
<td>匹配日期格式，设置为date<br />匹配数字，设置为float或者long，功能默认关闭<br />设置为text，并增加keyword子字段</td>
</tr>
<tr>
<td align="center">布尔值</td>
<td>boolean</td>
</tr>
<tr>
<td align="center">浮点数</td>
<td>float</td>
</tr>
<tr>
<td align="center">整数</td>
<td>long</td>
</tr>
<tr>
<td align="center">对象</td>
<td>object</td>
</tr>
<tr>
<td align="center">数组</td>
<td>由第一个非空数值的类型决定</td>
</tr>
<tr>
<td align="center">空值</td>
<td>忽略</td>
</tr>
</tbody></table>
</li>
<li><p>查看索引的映射</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://ip:port/索引名称/_mapping</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭动态映射</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT /_settings </span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;index.mapper.dynamic&quot;</span><span class="punctuation">:</span><span class="keyword">false</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li></li>
</ul>
<h3 id="3-3-映射"><a href="#3-3-映射" class="headerlink" title="3.3 映射"></a>3.3 映射</h3><ul>
<li><p>每个索引都拥有唯一的 <code>mapping type</code>，用来决定文档将如何被索引。<code>mapping type</code>由下面两部分组成</p>
<ul>
<li>Meta-fields：元字段用于自定义如何处理文档的相关元数据。 元字段的示例包括文档的<code>_index</code>，<code>_type</code>，<code>_id</code>和<code>_source</code>字段。</li>
<li>Fields or properties：映射类型包含与文档相关的字段或属性的列表。</li>
</ul>
</li>
<li><p>mapping</p>
<ul>
<li><p><strong>初始化mapping</strong>：在新增索引的时候添加mapping</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT /twitter</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>新增字段</strong>：为索引增加新的mapping，对fields的映射进行设置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT /twitter/_mapping</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>修改字段：mapping在建好之后不可以更改字段类型</strong>，但是可以通过重建索引和索引别名完成索引的字段重建</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># 原索引</span><br><span class="line">PUT my_index</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;create_date&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span>   <span class="string">&quot;date&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yyyy-MM-dd ||yyyy/MM/dd&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"># 创建新索引<span class="punctuation">,</span>重置原索引的字段</span><br><span class="line">PUT my_index2</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;create_date&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span>   <span class="string">&quot;text&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"># 同步数据</span><br><span class="line">POST _reindex                   </span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_index&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_index2&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"># 删除原索引</span><br><span class="line">DELETE my_index</span><br><span class="line"># 设置新索引别名</span><br><span class="line">POST /_aliases</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;add&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_index2&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;alias&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my_index&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h2 id="第四章-ES基础操作"><a href="#第四章-ES基础操作" class="headerlink" title="第四章 ES基础操作"></a>第四章 ES基础操作</h2><h3 id="4-1-ES服务查询"><a href="#4-1-ES服务查询" class="headerlink" title="4.1 ES服务查询"></a>4.1 ES服务查询</h3><ol>
<li><p><strong>查询ES服务信息</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GET /</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;8eaa5a50b54d&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cluster_name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;docker-cluster&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cluster_uuid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;cyhnwUkJR7eCj2Hb01r88Q&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;number&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;8.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_flavor&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;docker&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_hash&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;801d9ccc7c2ee0f2cb121bbe22ab5af77a902372&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_date&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-02-24T13:55:40.601285296Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_snapshot&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;lucene_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;9.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;minimum_wire_compatibility_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;7.17.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;minimum_index_compatibility_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;7.0.0&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tagline&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>_cat指令</strong></p>
<ul>
<li><p>指令说明：&amp;是参数连接符，可以多个参数一起使用</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>案例</th>
</tr>
</thead>
<tbody><tr>
<td>v（verbose）</td>
<td>显示指令的详细信息</td>
<td><strong>GET _cat/health?v</strong></td>
</tr>
<tr>
<td>help</td>
<td>示指令返回参数的说明</td>
<td><strong>GET _cat/health?help</strong></td>
</tr>
<tr>
<td>h（header）</td>
<td>选择要显示的列</td>
<td><strong>GET _cat/count?h=timestamp,count</strong></td>
</tr>
<tr>
<td>format</td>
<td>设置返回内容的格式</td>
<td><strong>GET _cat/master?format=json<br /></strong> - 支持json,yaml,text,smile,cbor</td>
</tr>
<tr>
<td>s（sort）</td>
<td>排序</td>
<td><strong>GET _cat/indices?s=store.size:desc</strong></td>
</tr>
</tbody></table>
</li>
<li><p><strong>_cat指令结果说明</strong></p>
<table>
<thead>
<tr>
<th>指令</th>
<th>说明</th>
<th>案例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>indices</strong></td>
<td>查看索引信息</td>
<td><strong>GET _cat/indices?v</strong> <br />  -  health：索引的健康状态<br/> - status：索引的开启状态<br/> - index：索引名字<br/> - uuid：索引的uuid<br/> - pri：索引的主分片数量<br/> - rep：索引的复制分片数量<br/> - docs.count：索引下的文档总数<br/> - docs.deleted：索引下删除状态的文档数<br/> - store.size：主分片+复制分片的大小<br/> - pri.store.size：主分片的大小</td>
</tr>
<tr>
<td><strong>plugins</strong></td>
<td>显示每个运行插件节点的视图</td>
<td><strong>GET _cat/plugins?v</strong> <br /> - name：节点名称<br/> - component：插件名称<br/> - version：插件版本</td>
</tr>
<tr>
<td><strong>shards</strong></td>
<td>查看分片信息</td>
<td><strong>GET _cat/shards?v</strong> <br />- index：索引名称<br/> - shard：分片序号<br/> - prirep：分片类型，p主，r复<br/> - state：分片状态<br/> - docs：该分片存放的文档数量<br/> - store：该分片占用的存储空间大小<br/> - ip：该分片所在的服务器ip<br/> - node：该分片所在的节点名称</td>
</tr>
<tr>
<td><strong>allocation</strong></td>
<td>显示每个节点分片数量、占用空间</td>
<td><strong>GET _cat/allocation?v</strong><br /> - shards：节点承载的分片数量<br /> - disk.indices：索引占用的空间大小<br /> - disk.used：已使用的磁盘空间大小<br /> - disk.avail：节点可用空间大小<br /> - disk.total：节点总空间大小<br /> - disk.percent：节点磁盘占用百分比<br /> - host：节点的host地址<br /> - ip：节点的ip地址<br /> - node：节点名称</td>
</tr>
<tr>
<td><strong>thread_pool</strong></td>
<td>查看线程池信息</td>
<td><strong>GET _cat/thread_pool?v</strong><br /> - node_name：节点名称<br/> - name：线程池名称<br/> - active：活跃线程数量<br/> - queue：当前队列中的任务数<br/> - rejected：被拒绝的任务数</td>
</tr>
<tr>
<td>aliases</td>
<td>显示别名、过滤器、路由信息</td>
<td><strong>GET _cat/aliases?v</strong><br /> - alias：别名<br /> - iindex：索引别名指向<br /> - filter：过滤规则<br /> - routing.index：索引路由<br /> - routing.search：搜索路由</td>
</tr>
<tr>
<td>count</td>
<td>显示索引文档数量</td>
<td><strong>GET _cat/count?v</strong><br /> - epoch：自标准时间以来的秒数 <br />- timestamp：时间<br /> - count：文档总数</td>
</tr>
<tr>
<td><strong>health</strong></td>
<td>查看集群健康状况</td>
<td><strong>GET _cat/health?v</strong><br /> - epoch：自标准时间以来的秒数 <br /> - timestamp：时间<br /> - cluster：集群名称<br /> - status：集群状态<br /> - node.total：节点总数<br /> - node.data：数据节点总数<br /> - shards：分片总数<br /> - pri：主分片总数<br /> - repo：复制节点的数量<br /> - init： 初始化节点的数量<br /> - unassign：未分配分片的数量<br /> - pending_tasks：待定任务数<br /> - max_task_wait_time：最长任务等待时间<br /> - active_shards_percent：活动分片百分比</td>
</tr>
<tr>
<td><strong>master</strong></td>
<td>显示master节点信息</td>
<td><strong>GET _cat/master?v</strong><br /> - id：节点ID<br/> - host：主机名称<br/> - ip：主机IP<br/> - node：节点名称</td>
</tr>
<tr>
<td>nodeattrs</td>
<td>显示node节点属性</td>
<td><strong>GET _cat/nodeattrs?v</strong><br /> - node：节点名称<br/> - host：主机地址<br/> - ip：主机ip<br/> - attr：属性描述<br/> - value：属性值</td>
</tr>
<tr>
<td>nodes</td>
<td>显示node节点信息</td>
<td><strong>GET _cat/nodes?v</strong> <br /> - ip：node节点的IP<br/> - heap.percent：堆内存占用百分比<br/> - ram.percent：内存占用百分比<br/> - cpu：CPU占用百分比<br/> - load_1m：1分钟的系统负载<br/> - load_5m：5分钟的系统负载<br/> - load_15m：15分钟的系统负载<br/> - node.role：node节点的角色<br/> - master：是否是master节点<br/> - name：节点名称</td>
</tr>
<tr>
<td>pending_tasks</td>
<td>显示正在等待的任务</td>
<td><strong>GET _cat/pending_tasks?v</strong> <br /> - insertOrder：任务插入顺序<br/> - timeInQueue：任务排队了多长时间<br/> - priority：任务优先级<br/> - source：任务源</td>
</tr>
<tr>
<td>recovery</td>
<td>显示索引碎片恢复的视图</td>
<td><strong>GET _cat/recovery?v</strong><br /> - index：索引名称<br/> - shard：分片名称<br/> - time：恢复时间<br/> - type：恢复类型<br/> - stage：恢复阶段<br/> - source_host：源主机<br/> - source_node：源节点名称<br/> - target_host：目标主机<br/> - target_node：目标节点名称<br/> - repository：仓库<br/> - snapshot：快照<br/> - files：要恢复的文件数<br/> - files_recovered：已恢复的文件数<br/> - files_percent：恢复文件百分比<br/> - files_total：文件总数<br/> - bytes：要恢复的字节数<br/> - bytes_recovered：已恢复的字节数<br/> - bytes_percent：恢复字节百分比<br/> - bytes_total：字节总数<br/> - translog_ops：要恢复的数<br/> - translog_ops_recovered：已恢复的数<br/> - translog_ops_percent：恢复的百分比</td>
</tr>
<tr>
<td>segments</td>
<td>显示碎片中的分段信息</td>
<td><strong>GET _cat/segments?v</strong><br /> - index：索引名称<br/> - shard：分片名称<br/> - prirep：主分片还是副本分片<br/> - ip：所在节点IP<br/> - segment：segments段名<br/> - generation：分段生成<br/> - docs.count：段中的文档树<br/> - docs.deleted：段中删除的文档数<br/> - size：段大小，以字节为单位<br/> - size.memory：段内存字节大小<br /> - committed：段是否已提交<br/> - searchable：段是否可搜索<br/> - version：版本<br/> - compound：compound模式</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ol>
<h3 id="4-2-索引操作"><a href="#4-2-索引操作" class="headerlink" title="4.2 索引操作"></a>4.2 索引操作</h3><h4 id="1-新建索引"><a href="#1-新建索引" class="headerlink" title="1. 新建索引"></a>1. 新建索引</h4><ul>
<li><p><strong>创建索引</strong>：使用PUT方式请求表示该请求具有幂等性，同样的请求只有发送一次，否则会报错</p>
</li>
<li><p>创建空索引：索引配置使用默认的配置值</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT /索引名称</span><br></pre></td></tr></table></figure>
</li>
<li><p>禁止自动创建索引：在全局配置文件 elasticsearch.yml 中</p>
<blockquote>
<ul>
<li>如果直接执行新增文档的操作，默认会直接创建这个索引；并且type字段也会自动创建。也就是说，ES并不需要像传统的数据库事先定义表的结构。</li>
<li>每个索引中的类型都有一个mapping映射，这个映射是动态生成的，因此当增加新的字段时，会自动增加mapping的设置。</li>
<li>通过在配置文件中设置action.auto_create_index为false，可以关闭自动创建index这个功能。</li>
<li>也可以设置黑名单或者白名单，比如：设置action.auto_create_index为<code>+aaa*,-bbb*</code>，<code>+</code>号意味着允许创建aaa开头的索引，<code>-</code>号意味着不允许创建bbb开头的索引。</li>
</ul>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">action.auto_create_index:false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建索引并设置分片和副本</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT /索引名称</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> 分片数量<span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> 副本数量</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建指定名称的索引并设置索引mapping：详细用法参考mapping</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT /索引名称</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mapping&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;&lt;字段&gt;&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;字段的数据类型&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="2-查询索引"><a href="#2-查询索引" class="headerlink" title="2. 查询索引"></a>2. 查询索引</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有索引</span></span><br><span class="line">GET /_cat/indices</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有索引完整信息</span></span><br><span class="line">GET /_all</span><br><span class="line"><span class="comment"># 查看单个索引完整信息</span></span><br><span class="line">GET /user_empty</span><br><span class="line"><span class="comment"># 查看多个索引完整信息</span></span><br><span class="line">GET /user_empty,user_setting</span><br><span class="line"><span class="comment"># 查看集群中所有索引的setting信息</span></span><br><span class="line">GET /_all/_settings</span><br><span class="line"><span class="comment"># 查看集群中所有索引的mapping信息</span></span><br><span class="line">GET /_all/_mapping</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看索引的setting信息</span></span><br><span class="line">GET /user_setting/_settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看索引的mapping信息</span></span><br><span class="line">GET /user_mapping/_mapping</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看多个索引的settings信息</span></span><br><span class="line">GET /user_empty,user_mapping/_settings</span><br><span class="line"><span class="comment"># 查看多个索引的mapping信息</span></span><br><span class="line">GET /user_empty,user_mapping/_mapping</span><br></pre></td></tr></table></figure>

<h4 id="3-编辑索引"><a href="#3-编辑索引" class="headerlink" title="3. 编辑索引"></a>3. 编辑索引</h4><ul>
<li><p><strong>修改索引的副本数</strong>：分片数据创建后不能修改</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /&lt;索引名称&gt;/_settings</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;number_of_replicas&quot;</span>: 2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>增加索引字段</strong>：已定义好的字段不允许被修改</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT /&lt;索引名称&gt;/_mapping</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;properties&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;字段名称&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>:<span class="string">&quot;自动类型&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="4-删除索引"><a href="#4-删除索引" class="headerlink" title="4.删除索引"></a>4.删除索引</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DELETE /&lt;索引名称&gt;</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="5-索引打开和关闭"><a href="#5-索引打开和关闭" class="headerlink" title="5. 索引打开和关闭"></a>5. 索引打开和关闭</h4><blockquote>
<p>索引关闭以后就几乎不会占用系统资源</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 关闭单个索引</span><br><span class="line">POST /索引名称/_close</span><br><span class="line"></span><br><span class="line"># 关闭多个索引</span><br><span class="line">POST /索引名称1,索引名称2/_close</span><br><span class="line"></span><br><span class="line"># 关闭所以并添加ignore_unavailable参数:如果关闭不存在索引,设置是否抛异常</span><br><span class="line">POST /索引名称1,索引名称2/_close?ignore_unavailable=true</span><br><span class="line"></span><br><span class="line"># 关闭集群中所有索引</span><br><span class="line">POST /_all/_close</span><br><span class="line"></span><br><span class="line"># 使用通配符关闭索引</span><br><span class="line">POST /test*/_close</span><br></pre></td></tr></table></figure>

<h4 id="6-索引别名"><a href="#6-索引别名" class="headerlink" title="6. 索引别名"></a>6. 索引别名</h4><ul>
<li><p>创建索引别名</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;索引名称&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;索引名称对应的别名&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>移除索引别名</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;actions&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;remove&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;index&quot;</span>: <span class="string">&quot;索引名称&quot;</span>,</span><br><span class="line">        <span class="string">&quot;alias&quot;</span>: <span class="string">&quot;索引名称对应的别名&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看索引的别名</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /索引名称/_aliases</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看一个别名所对应的索引</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /索引别名/_aliases</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看集群中所有可用别名</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /_all/_aliases</span><br><span class="line">或</span><br><span class="line">GET /_aliases</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="4-3-文档操作"><a href="#4-3-文档操作" class="headerlink" title="4.3 文档操作"></a>4.3 文档操作</h3><h4 id="1-新建文档"><a href="#1-新建文档" class="headerlink" title="1. 新建文档"></a>1. 新建文档</h4><blockquote>
<ul>
<li>新版es中索引中type默认为_doc</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加文档,返回的内置信息中会包含随机生成的id,POST新增请求不是幂等性,每次都是一个新请求,PUT请求要求是幂等性,每次请求要求唯一</span></span><br><span class="line">POST http://localhost:9200/索引名称/_doc</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;key&quot;</span>:<span class="string">&quot;value&quot;</span>,</span><br><span class="line">	... ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 添加文档并设置自定义ID,带唯一ID后POST请求是具有幂等性,此时新增请求方式也可以是PUT</span></span><br><span class="line">POST http://localhost:9200/索引名称/_doc/唯一ID</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;key&quot;</span>:<span class="string">&quot;value&quot;</span>,</span><br><span class="line">	... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-编辑文档"><a href="#2-编辑文档" class="headerlink" title="2. 编辑文档"></a>2. 编辑文档</h4><blockquote>
<ul>
<li>put 整个文档的更新</li>
<li>put 只更新单个字段</li>
<li>put 增量字段</li>
<li>put 基于乐观锁的更新</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">完全修改,覆盖元数据</span><br><span class="line">PUT http://localhost:9200/索引名称/_doc/覆盖的ID</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;key&quot;</span>:<span class="string">&quot;value&quot;</span>,</span><br><span class="line">	... ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">局部数据更新,修改请求不是幂等性,必须使用post,局部修改需要说明修改doc中的某个字段</span><br><span class="line">POST http://localhost:9200/索引名称/_doc/修改的文档ID</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;doc&quot;</span>:&#123;</span><br><span class="line">		<span class="string">&quot;修改的属性&quot;</span>:<span class="string">&quot;修改的值&quot;</span>,</span><br><span class="line">		... ...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-删除文档"><a href="#3-删除文档" class="headerlink" title="3. 删除文档"></a>3. 删除文档</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELET http://localhost:9200/索引名称/_doc/删除ID</span><br></pre></td></tr></table></figure>

<h2 id="第五章-ES检索分析"><a href="#第五章-ES检索分析" class="headerlink" title="第五章 ES检索分析"></a>第五章 ES检索分析</h2><h3 id="5-1-检索"><a href="#5-1-检索" class="headerlink" title="5.1 检索"></a>5.1 检索</h3><ol>
<li><p>主键查询</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http<span class="punctuation">:</span><span class="comment">//localhost:9200/索引名称/_doc/查询ID</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>query查询</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:9200/索引名称/_search?q=key:查询的值&amp;... ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>match_all</p>
</li>
<li><p>match</p>
</li>
<li><p>term</p>
</li>
<li><p>区间检索</p>
</li>
<li><p>_source检索需要的字段、过滤字段</p>
</li>
<li><p>range区间查</p>
</li>
<li><p>复合查询bool</p>
</li>
<li><p>filter与match</p>
</li>
<li><p>fuzzy近似查询</p>
</li>
<li><p>match_phrase断句匹配,查询的是整个断句</p>
</li>
<li><p>multi_match:多字段查询,一个只从多个字段匹配</p>
</li>
<li><p>terms</p>
</li>
<li><p>should</p>
</li>
<li><p>must_not</p>
</li>
<li><p>post_filter</p>
</li>
<li><p>HEAD /索引/_doc/ID:判断文档是否存在</p>
</li>
<li><p>用ID批量差:<code>_doc/_mget</code></p>
</li>
<li><p>批量操作:_bulk,新增,修改,删除</p>
</li>
<li><p>分页查询</p>
</li>
<li><p>排序</p>
</li>
<li><p>高亮</p>
</li>
<li><p>主键查询</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:9200/索引名称/<span class="built_in">_</span>doc/查询ID</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询所有:_search</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:9200/索引名称/<span class="built_in">_</span>search</span><br></pre></td></tr></table></figure>
</li>
<li><p>条件查询1- 使用query参数查询</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">    </span><br></pre></td></tr></table></figure>
</li>
<li><p>条件查询2 - 使用请求体查询 query表示是一个查询参数</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:9200/索引名称/<span class="built_in">_</span>doc</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">		&quot;查询条件&quot;:&#123;</span><br><span class="line">			&quot;条件匹配字段&quot;:&quot;查询的值&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>match - 表示匹配查询,需要指定匹配字段和匹配值</li>
<li>match_al - 表示全部匹配, 无需指定匹配字段</li>
</ul>
</blockquote>
</li>
<li><p>分页查询: form表示查询起始位置 size表示需要查询的条数</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:9200/索引名称/<span class="built_in">_</span>doc</span><br><span class="line">&#123;</span><br><span class="line">	&quot;from&quot;:&quot;&quot;,</span><br><span class="line">	&quot;to&quot;:&quot;&quot;,</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">		&quot;match&quot;:&#123;</span><br><span class="line">			&quot;条件匹配字段&quot;:&quot;查询的值&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询需要的字段: _source数组中说明需要返回的字段</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:9200/索引名称/<span class="built_in">_</span>doc</span><br><span class="line">&#123;</span><br><span class="line">	&quot;from&quot;:&quot;&quot;,</span><br><span class="line">	&quot;to&quot;:&quot;&quot;,</span><br><span class="line">	&quot;<span class="built_in">_</span>source&quot;:[&quot;需要返回的字段&quot;],</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">		&quot;match&quot;:&#123;</span><br><span class="line">			&quot;条件匹配字段&quot;:&quot;查询的值&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>排序查询</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET http://localhost:9200/索引名称/<span class="built_in">_</span>doc</span><br><span class="line">&#123;</span><br><span class="line">	&quot;from&quot;:&quot;&quot;,</span><br><span class="line">	&quot;to&quot;:&quot;&quot;,</span><br><span class="line">	&quot;<span class="built_in">_</span>source&quot;:[&quot;需要返回的字段&quot;],</span><br><span class="line">	&quot;sort&quot;:&#123;</span><br><span class="line">		&quot;排序字段&quot;:&#123;</span><br><span class="line">			&quot;order&quot;:&quot;asc|desc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">		&quot;match&quot;:&#123;</span><br><span class="line">			&quot;条件匹配字段&quot;:&quot;查询的值&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>多条件查询: bool -&gt; must | should | filter（过滤：可以范围查询range -&gt; gt | lt | eq | ）</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span>			<span class="comment">// 表示是查询</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span>		<span class="comment">// 表示使用条件查询</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span>	<span class="comment">// 表示这个集合中的条件必须全部匹配</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;匹配字段&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;匹配字段&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>全文检索</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">es text类型默认是standard分词</span><br><span class="line">全文匹配: match<span class="built_in">_</span>phrase</span><br><span class="line">高亮显示:显示需要高亮的字段,默认前缀是&lt;em&gt;</span><br><span class="line">highlight:&#123;</span><br><span class="line">	&quot;fields&quot;:&#123;</span><br><span class="line">		&quot;高亮的字段&quot;:&#123;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>聚合查询:查询结果分析</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;aggs&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span>		<span class="comment">// 表示是聚合操作</span></span><br><span class="line">    <span class="attr">&quot;自定义的聚合名称&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span>		<span class="comment">// terms关键字表示分组</span></span><br><span class="line">        <span class="string">&quot;分组字段&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;avg&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span>		<span class="comment">// avg关键字表示统计平均值</span></span><br><span class="line">        <span class="string">&quot;求平均字段&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span>	</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="5-2-分析"><a href="#5-2-分析" class="headerlink" title="5.2 分析"></a>5.2 分析</h3><ul>
<li>aggs</li>
<li>avg</li>
<li>terms:根据什么字段分组</li>
</ul>
<h2 id="第六章-ES-Java-Client"><a href="#第六章-ES-Java-Client" class="headerlink" title="第六章 ES Java Client"></a>第六章 ES Java Client</h2><h3 id="6-1-Java客户端类型"><a href="#6-1-Java客户端类型" class="headerlink" title="6.1 Java客户端类型"></a>6.1 Java客户端类型</h3><ol>
<li>Java Client [8.1]：这是 Elasticsearch 的官方 Java API 客户端的文档。客户端为所有 Elasticsearch API 提供强类型请求和响应。</li>
<li>Java REST Client (过期) [7.17] ：Java REST 客户端已弃用，取而代之的是 Java API 客户端。包括①Java Low Level REST Client：低级客户端，允许通过 http 与 Elasticsearch 集群通信②Java High Level REST Client：基于低级客户端，它公开 API 特定的方法，并负责请求编组和响应解编组。</li>
<li>Java Transport Client (过期) [7.17]：TransportClient 已弃用，取而代之的是 Java 高级 REST 客户端，并将在 Elasticsearch 8.0 中删除。Java Transport Client是Java操作ES的一种客户端，是ES5版本就存在的一中API操作方式</li>
</ol>
<h3 id="6-2-JavaClient"><a href="#6-2-JavaClient" class="headerlink" title="6.2 JavaClient"></a>6.2 JavaClient</h3><ol>
<li><p>添加依赖</p>
<ul>
<li><p>gradle </p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation <span class="string">&#x27;co.elastic.clients:elasticsearch-java:8.1.0&#x27;</span></span><br><span class="line">    implementation <span class="string">&#x27;com.fasterxml.jackson.core:jackson-databind:2.12.3&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>maven</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>co.elastic.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>JavaClient核心组件</p>
<ul>
<li>API client classes：它们为 Elasticsearch API 提供强类型数据结构和方法。由于 Elasticsearch API 很大，它以功能组（也称为“命名空间”）的形式构成，每个组都有自己的客户端类。 Elasticsearch 核心功能在 ElasticsearchClient 类中实现。</li>
<li>A JSON object mapper：这会将您的应用程序类映射到 JSON 并将它们与 API 客户端无缝集成。</li>
<li>A transport layer implementation：这是所有 HTTP 请求处理发生的地方。</li>
</ul>
</li>
<li><p>组合三个组件，建立链接</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create the low-level client</span></span><br><span class="line"><span class="type">RestClient</span> <span class="variable">client</span> <span class="operator">=</span> RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">9200</span>)).build();</span><br><span class="line"><span class="comment">// 创建 the transport with a Jackson mapper</span></span><br><span class="line"><span class="type">ElasticsearchTransport</span> <span class="variable">tp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestClientTransport</span>(client, <span class="keyword">new</span> <span class="title class_">JacksonJsonpMapper</span>());</span><br><span class="line"><span class="comment">// 创建 the API client</span></span><br><span class="line"><span class="type">ElasticsearchClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElasticsearchClient</span>(tp);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create the low-level client</span></span><br><span class="line"><span class="type">RestClientBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">9200</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create the HLRC</span></span><br><span class="line"><span class="type">RestHighLevelClient</span> <span class="variable">hlrc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(builder);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create the new Java Client with the same low level client</span></span><br><span class="line"><span class="type">ElasticsearchTransport</span> <span class="variable">tr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestClientTransport</span>(hlrc.getLowLevelClient(),<span class="keyword">new</span> <span class="title class_">JacksonJsonpMapper</span>());</span><br><span class="line"></span><br><span class="line"><span class="type">ElasticsearchClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElasticsearchClient</span>(tr);</span><br></pre></td></tr></table></figure>
</li>
<li><p>发送请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">SearchResponse&lt;Product&gt; search = </span><br><span class="line">    client.search(s -&gt; s</span><br><span class="line">                  .index(<span class="string">&quot;products&quot;</span>)</span><br><span class="line">                  .query(q -&gt; q</span><br><span class="line">                         .term(t -&gt; t</span><br><span class="line">                               .field(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">                               .value(v -&gt; v.stringValue(<span class="string">&quot;bicycle&quot;</span>))</span><br><span class="line">                              )),</span><br><span class="line">                  Product.class);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Hit&lt;Product&gt; hit: search.hits().hits()) &#123;</span><br><span class="line">    processProduct(hit.source());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="6-3-RestHighLevelClient"><a href="#6-3-RestHighLevelClient" class="headerlink" title="6.3 RestHighLevelClient"></a>6.3 RestHighLevelClient</h3><h2 id="第七章-ES集群"><a href="#第七章-ES集群" class="headerlink" title="第七章 ES集群"></a>第七章 ES集群</h2><h1 id="第二部分-Kibana"><a href="#第二部分-Kibana" class="headerlink" title="第二部分 Kibana"></a>第二部分 Kibana</h1><h2 id="第一章-Kibana入门"><a href="#第一章-Kibana入门" class="headerlink" title="第一章 Kibana入门"></a>第一章 Kibana入门</h2><h3 id="1-1-Kibana介绍"><a href="#1-1-Kibana介绍" class="headerlink" title="1.1 Kibana介绍"></a>1.1 Kibana介绍</h3><h3 id="1-2-Kibana安装"><a href="#1-2-Kibana安装" class="headerlink" title="1.2 Kibana安装"></a>1.2 Kibana安装</h3><ol>
<li><p>Linux系统安装</p>
<ul>
<li><p>下载解压</p>
<blockquote>
<ul>
<li>新建Kibana安装目录：/opt/kibana</li>
<li>将Kibana安装包解压到/opt/kibana目录中：Kibana的版本必须和ElasticSearch版本相同</li>
</ul>
</blockquote>
</li>
<li><p>修改配置：/opt/kibana/config/kibana.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Kibana 服务启动端口</span></span><br><span class="line"><span class="attr">server.port:</span> <span class="number">5601</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定Kibana服务器要绑定到的地址</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">&quot;192.168.57.129&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于所有查询的Elasticsearch实例的url</span></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [<span class="string">&quot;http://192.168.57.129:9200&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 中文管理页</span></span><br><span class="line"><span class="attr">i18n.locale:</span> <span class="string">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Linux服务器开启kibana服务运行端口：5601</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=5601/tcp --permanent </span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>
</li>
<li><p>切换到非root用户,并将kibana安装目录指定为当前用户所属</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> elsearch:elsearch -R /opt/kibana</span><br><span class="line">su - elsearch</span><br><span class="line">/opt/kibana/kibana &amp;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Docker命令行</p>
<ul>
<li><p>下载Kibana镜像</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull kibana:8.0.1</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用命令行安装docker：①需要准备好宿主机中config中的配置文件②修改下面命令行中的数据集容器卷路径</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name kibana1 -p 5601:5601 \</span><br><span class="line">-v ~source_docker/kibana/config:/usr/share/kibana/config kibana:8.0.1</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>DockerCompose</p>
<ul>
<li><p>下载Kibana镜像</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull kibana:8.2.0</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义主机容器卷的目录如下结构：同一套版本的ElasticSearch和Kibana定义在同一目录ElasticSearch8，es和Kibana定义在各自的文件目录中</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ElasticSearch8/</span><br><span class="line">	es8/</span><br><span class="line">		/data/</span><br><span class="line">		/logs/</span><br><span class="line">		/config/</span><br><span class="line">			/elasticsearch.yml</span><br><span class="line">			/jvm.options</span><br><span class="line">			/log4j2.properties</span><br><span class="line">	kibana/</span><br><span class="line">		config/kibana.yml</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义docker-compose.yml文件在ElasticSearch8的根目录中</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker network create elk</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">es8:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:8.2.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es8</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9200:9200&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9300:9300&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./es8/data:/usr/share/elasticsearch/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./es8/logs:/usr/share/elasticsearch/logs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./es8/config:/usr/share/elasticsearch/config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./es8/plugins:/usr/share/elasticsearch/plugins</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.type=single-node</span></span><br><span class="line">  <span class="attr">kibana8:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">kibana:8.2.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kibana8</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5601:5601&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./kibana8/config:/usr/share/kibana/config</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ELASTICSEARCH_HOSTS:</span> <span class="string">http://es8:9200</span></span><br><span class="line">      <span class="attr">I18N_LOCALE:</span> <span class="string">zh-CN</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">es8</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
<h3 id="1-3-Kibana配置文件详解"><a href="#1-3-Kibana配置文件详解" class="headerlink" title="1.3 Kibana配置文件详解"></a>1.3 Kibana配置文件详解</h3><h1 id="第三部分-LogStash"><a href="#第三部分-LogStash" class="headerlink" title="第三部分 LogStash"></a>第三部分 LogStash</h1><h1 id="第四部分-Beats"><a href="#第四部分-Beats" class="headerlink" title="第四部分 Beats"></a>第四部分 Beats</h1>
      
      <!-- reward -->
      
      <div id="reward-btn">
        打赏
      </div>
      
    </div>
    
    
      <!-- copyright -->
      
        <div class="declare">
          <ul class="post-copyright">
            <li>
              <i class="ri-copyright-line"></i>
              <strong>版权声明： </strong s>
              本博客所有文章除特别声明外，均采用 <a href="https://www.apache.org/licenses/LICENSE-2.0.html" rel="external nofollow"
                target="_blank">Apache License 2.0</a> 许可协议。转载请注明出处！
            </li>
          </ul>
        </div>
        
    <footer class="article-footer">
      
          
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://yoursite.com/2008/01/01/0801-ElasticStack/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ELK/" rel="tag">ELK</a></li></ul>


    </footer>

  </div>

  
  
  <nav class="article-nav">
    
      <a href="/2008/02/01/0802-Docker/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            0802-Docker
          
        </div>
      </a>
    
    
      <a href="/2006/03/01/0603-Flutter/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">0603-Flutter</div>
      </a>
    
  </nav>


  

  
  
<!-- valine评论 -->
<div id="vcomments-box">
    <div id="vcomments">
    </div>
</div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>
<script>
    new Valine({
        el: '#vcomments',
        app_id: 'x4LtuVoSSI8Fyi6hvbBmupL5-gzGzoHsz',
        app_key: '47DsbAAlOYTY98njMBmsyEIm',
        path: window.location.pathname,
        notify: 'false',
        verify: 'true',
        avatar: 'robohash',
        placeholder: '给我的文章加点评论吧~',
        recordIP: true
    });
    const infoEle = document.querySelector('#vcomments .info');
    if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
        infoEle.childNodes.forEach(function (item) {
            item.parentNode.removeChild(item);
        });
    }
</script>
<style>
    #vcomments-box {
        padding: 5px 30px;
    }

    @media screen and (max-width: 800px) {
        #vcomments-box {
            padding: 5px 0px;
        }
    }

    #vcomments-box #vcomments {
        background-color: #fff;
    }

    .v .vlist .vcard .vh {
        padding-right: 20px;
    }

    .v .vlist .vcard {
        padding-left: 10px;
    }
</style>

  

  
  
  

</article>
</section>
      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2020-2022
        xiaoliuxuesheng
      </li>
      <li>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <span>
  <i>PV:<span id="busuanzi_value_page_pv"></span></i>
  <i>UV:<span id="busuanzi_value_site_uv"></span></i>
</span>
        
      </li>
      
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s4.cnzz.com/z_stat.php?id=1279413779&amp;web_id=1279413779'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
    <aside class="sidebar">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="乘风破浪 披荆斩棘"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2019/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>老板,来一杯Java</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/share.js"></script>


<script src="/js/lazyload.min.js"></script>


<script>
  try {
    var typed = new Typed("#subtitle", {
      strings: ['在钢铁水泥的森林里 路在何方', '在鱼龙混杂的江湖里 何去何从', ''],
      startDelay: 0,
      typeSpeed: 400,
      loop: false,
      backSpeed: 40,
      showCursor: false
    });
  } catch (err) {
  }

</script>




<script src="/js/tocbot.min.js"></script>

<script>
  // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: 'main',
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
    onClick: (e) => {
      $('.toc-link').removeClass('is-active-link');
      $(`a[href=${e.target.hash}]`).addClass('is-active-link');
      $(e.target.hash).scrollIntoView();
      return false;
    }
  });
</script>



<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/js/ayer.js"></script>



<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>




<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=1384718065&auto=0&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
  </div>
</body>

</html>